<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: ModelsHelper</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">ModelsHelper</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/helpers/models_helper_rb.html">
                app/helpers/models_helper.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000400">canvas_for</a>&nbsp;&nbsp;
      <a href="#M000401">canvas_for_model</a>&nbsp;&nbsp;
      <a href="#M000402">canvas_for_model_in_inventory_pools</a>&nbsp;&nbsp;
      <a href="#M000399">javascript_include_flotr</a>&nbsp;&nbsp;
      <a href="#M000403">pie_for_model</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000400" class="method-detail">
        <a name="M000400"></a>

        <div class="method-heading">
          <a href="#M000400" class="method-signature">
          <span class="method-name">canvas_for</span><span class="method-args">(obj, inventory_pool, params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000400-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000400-source">
<pre>
    <span class="ruby-comment cmt"># File app/helpers/models_helper.rb, line 17</span>
17:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">canvas_for</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">inventory_pool</span>, <span class="ruby-identifier">params</span> = {})
18:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>
19:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;Model&quot;</span>
20:         <span class="ruby-identifier">canvas_for_model</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">inventory_pool</span>, <span class="ruby-identifier">params</span>)
21:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;Category&quot;</span>
22:         <span class="ruby-comment cmt"># TODO</span>
23:      <span class="ruby-keyword kw">end</span>
24:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000401" class="method-detail">
        <a name="M000401"></a>

        <div class="method-heading">
          <a href="#M000401" class="method-signature">
          <span class="method-name">canvas_for_model</span><span class="method-args">(model, inventory_pool, params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Flotr Javascript Library required
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000401-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000401-source">
<pre>
     <span class="ruby-comment cmt"># File app/helpers/models_helper.rb, line 28</span>
 28:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">canvas_for_model</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">inventory_pool</span>, <span class="ruby-identifier">params</span> = {})
 29:     
 30:     <span class="ruby-comment cmt">#return if items.empty?</span>
 31:     
 32:     <span class="ruby-identifier">config</span> = {<span class="ruby-identifier">:canvas</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">800</span>, <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">300</span>},
 33:               <span class="ruby-identifier">:line</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span>},
 34:               <span class="ruby-identifier">:range</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:start_days</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">-50</span>, <span class="ruby-identifier">:end_days</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">150</span>},
 35:               <span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:xaxis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-value str">'Time'</span>), <span class="ruby-identifier">:x2axis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-value str">'Available Quantity'</span>), <span class="ruby-identifier">:yaxis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-value str">'Items'</span>)}
 36:               }
 37:     <span class="ruby-identifier">items</span> = <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:filter</span>]
 38:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;own&quot;</span>
 39:                 <span class="ruby-identifier">inventory_pool</span>.<span class="ruby-identifier">own_items</span>.<span class="ruby-identifier">scoped_by_model_id</span>(<span class="ruby-identifier">model</span>).<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;is_borrowable DESC, inventory_code DESC&quot;</span>)
 40:               <span class="ruby-keyword kw">else</span>
 41:                 <span class="ruby-identifier">inventory_pool</span>.<span class="ruby-identifier">items</span>.<span class="ruby-identifier">scoped_by_model_id</span>(<span class="ruby-identifier">model</span>).<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;is_borrowable DESC, inventory_code DESC&quot;</span>)
 42:             <span class="ruby-keyword kw">end</span>
 43:     <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_sec</span>] = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_days</span>] <span class="ruby-operator">*</span> <span class="ruby-value">86400</span>
 44:     <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_sec</span>] = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_days</span>] <span class="ruby-operator">*</span> <span class="ruby-value">86400</span>
 45: 
 46:     <span class="ruby-identifier">today</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
 47:     <span class="ruby-identifier">x_ticks</span> = [[<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value str">'^'</span>]]
 48:     <span class="ruby-identifier">x2_ticks</span> = []
 49:     <span class="ruby-identifier">y_ticks</span> = []
 50:     <span class="ruby-identifier">data</span> = []
 51:     <span class="ruby-identifier">events</span> = []
 52:     <span class="ruby-identifier">items_users</span> = {}
 53:     <span class="ruby-identifier">html</span> = <span class="ruby-value str">&quot;&quot;</span>
 54:     <span class="ruby-identifier">first_date_in_chart</span> = (<span class="ruby-identifier">today</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_days</span>].<span class="ruby-identifier">days</span>)
 55:     
 56:     <span class="ruby-identifier">dd</span> = <span class="ruby-identifier">first_date_in_chart</span>.<span class="ruby-identifier">at_beginning_of_month</span>
 57:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_sec</span>] <span class="ruby-keyword kw">do</span>
 58:       <span class="ruby-identifier">x_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%b&quot;</span>)] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_sec</span>] 
 59:       <span class="ruby-identifier">dd</span> = <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">next_month</span>
 60:     <span class="ruby-keyword kw">end</span>
 61:     
 62:  
 63:     <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
 64:       <span class="ruby-identifier">y</span> = <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
 65:       <span class="ruby-identifier">styled_inventory_code</span> = (<span class="ruby-identifier">item</span>.<span class="ruby-identifier">is_borrowable?</span> <span class="ruby-value">? </span><span class="ruby-identifier">item</span>.<span class="ruby-identifier">inventory_code</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;&lt;span style='color:red;'&gt;#{item.inventory_code}&lt;/span&gt;&quot;</span>) 
 66:       <span class="ruby-identifier">y_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">y</span>, <span class="ruby-identifier">styled_inventory_code</span>]
 67:     <span class="ruby-keyword kw">end</span>
 68: 
 69: <span class="ruby-comment cmt"># TODO: don't select procedurally. use rather SQL or activerecord :conditions ...</span>
 70:     <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">inventory_pool</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">inventory_pool</span>}
 71:     <span class="ruby-identifier">lines_with_item</span> = <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">item</span> }
 72:     <span class="ruby-identifier">lines_without_item</span> = <span class="ruby-identifier">lines</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lines_with_item</span>
 73: 
 74:     <span class="ruby-identifier">lines_with_item</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
 75:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">item</span>.<span class="ruby-identifier">retired?</span>
 76:       <span class="ruby-identifier">y</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">l</span>.<span class="ruby-identifier">item</span>)
 77:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">nil?</span>
 78:       <span class="ruby-identifier">y</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
 79:       <span class="ruby-comment cmt">#debug# html += &quot;&lt;br&gt;#{l.quantity}: #{l.start_date} - #{l.end_date} #{l.item.inventory_code}&quot;</span>
 80:       <span class="ruby-identifier">start_date</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>
 81:       <span class="ruby-identifier">end_date</span> = (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">returned_date</span> <span class="ruby-value">? </span>(<span class="ruby-identifier">l</span>.<span class="ruby-identifier">returned_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">12</span>.<span class="ruby-identifier">hours</span>).<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">end_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">12</span>.<span class="ruby-identifier">hours</span>).<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>)
 82: 
 83:       <span class="ruby-identifier">color</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">returned_date</span>
 84:                 <span class="ruby-value str">'#e1e157'</span>
 85:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">end_date</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">today</span>
 86:                 <span class="ruby-value str">'red'</span>
 87:               <span class="ruby-keyword kw">else</span>
 88:                 <span class="ruby-value str">'#e3aa01'</span>
 89:               <span class="ruby-keyword kw">end</span>
 90:       <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_date</span>, <span class="ruby-identifier">:y</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">y</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">color</span>}
 91:       <span class="ruby-comment cmt">#TODO optimize the following horrible data-structure out and just use the Jquery oriented Flot library, which offers more flexibility in graph handling.</span>
 92:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">item</span>.<span class="ruby-identifier">inventory_code</span>].<span class="ruby-identifier">nil?</span>
 93:         <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">item</span>.<span class="ruby-identifier">inventory_code</span>] = {<span class="ruby-identifier">start_date</span> =<span class="ruby-operator">&gt;</span>[ <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">phone</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">end_date</span> ], <span class="ruby-identifier">end_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">start_date</span>]}
 94:       <span class="ruby-keyword kw">else</span>
 95:         <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">l</span>.<span class="ruby-identifier">item</span>.<span class="ruby-identifier">inventory_code</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">start_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">phone</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">end_date</span>], <span class="ruby-identifier">end_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">start_date</span>])
 96:       <span class="ruby-keyword kw">end</span>
 97:     <span class="ruby-keyword kw">end</span>
 98:     <span class="ruby-identifier">lines_without_item</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
 99:       <span class="ruby-comment cmt">#debug# html += &quot;&lt;br&gt;#{l.quantity}: #{l.start_date} - #{l.end_date}&quot;</span>
100:       <span class="ruby-identifier">start_date</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>
101:       <span class="ruby-identifier">end_date</span> = (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">end_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">12</span>.<span class="ruby-identifier">hours</span>).<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>
102:       <span class="ruby-identifier">l</span>.<span class="ruby-identifier">quantity</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
103:         <span class="ruby-identifier">y</span> = <span class="ruby-keyword kw">nil</span>
104:         (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">items</span>.<span class="ruby-identifier">size</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
105:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">events</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span>[<span class="ruby-identifier">:y</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">e</span>[<span class="ruby-identifier">:start</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">end_date</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">e</span>[<span class="ruby-identifier">:end</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_date</span>} <span class="ruby-comment cmt">#old# &lt;= and &gt;=</span>
106:             <span class="ruby-identifier">y</span> = <span class="ruby-identifier">k</span>
107:             <span class="ruby-keyword kw">break</span>
108:           <span class="ruby-keyword kw">end</span>
109:         <span class="ruby-keyword kw">end</span>
110: 
111:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">nil?</span>
112:           <span class="ruby-identifier">y</span> = <span class="ruby-identifier">y_ticks</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
113:           <span class="ruby-identifier">y_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">y</span>, <span class="ruby-identifier">_</span>(<span class="ruby-value str">&quot;Overbooked&quot;</span>)]
114:         <span class="ruby-keyword kw">end</span>
115: 
116:         <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">start_date</span>, <span class="ruby-identifier">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_date</span>, <span class="ruby-identifier">:y</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">y</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'grey'</span>}
117: 
118:         <span class="ruby-comment cmt">#TODO make less clunky</span>
119:         <span class="ruby-identifier">inventory_code</span> = <span class="ruby-identifier">y_ticks</span>[<span class="ruby-identifier">y</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>][<span class="ruby-value">1</span>]
120:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">OrderLine</span>
121:           <span class="ruby-comment cmt">#TODO further horrible data-structure, pending Flot implementation.</span>
122:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">inventory_code</span>].<span class="ruby-identifier">nil?</span>
123:              <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">inventory_code</span>] = {<span class="ruby-identifier">start_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">l</span>.<span class="ruby-identifier">order</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">phone</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">end_date</span>], <span class="ruby-identifier">end_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">start_date</span>]}
124:            <span class="ruby-keyword kw">else</span>
125:              <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">inventory_code</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">start_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">l</span>.<span class="ruby-identifier">order</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">phone</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">end_date</span>], <span class="ruby-identifier">end_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">start_date</span>])
126:            <span class="ruby-keyword kw">end</span>
127:         <span class="ruby-keyword kw">else</span>
128:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">inventory_code</span>].<span class="ruby-identifier">nil?</span>
129:              <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">inventory_code</span>] = {<span class="ruby-identifier">start_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">phone</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">end_date</span>], <span class="ruby-identifier">end_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">start_date</span>]}
130:           <span class="ruby-keyword kw">else</span>
131:              <span class="ruby-identifier">items_users</span>[<span class="ruby-identifier">inventory_code</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">start_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">l</span>.<span class="ruby-identifier">document</span>.<span class="ruby-identifier">user</span>.<span class="ruby-identifier">phone</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">end_date</span>], <span class="ruby-identifier">end_date</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">start_date</span>])
132:           <span class="ruby-keyword kw">end</span>
133:         <span class="ruby-keyword kw">end</span>
134: 
135:       <span class="ruby-keyword kw">end</span>
136:     <span class="ruby-keyword kw">end</span>
137: 
138:     <span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
139:       <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> [[<span class="ruby-identifier">e</span>[<span class="ruby-identifier">:start</span>], <span class="ruby-identifier">e</span>[<span class="ruby-identifier">:y</span>]], [<span class="ruby-identifier">e</span>[<span class="ruby-identifier">:end</span>], <span class="ruby-identifier">e</span>[<span class="ruby-identifier">:y</span>]]], <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>[<span class="ruby-identifier">:color</span>]}
140:     <span class="ruby-keyword kw">end</span>
141:     
142:     <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> [[<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">0</span>], [<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">0</span>]], <span class="ruby-identifier">:xaxis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>} <span class="ruby-comment cmt"># NOTE forcing to render x2axis # TODO 2502** keep from events?</span>
143:     <span class="ruby-identifier">availability</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">available_periods_for_inventory_pool</span>(<span class="ruby-identifier">inventory_pool</span>, <span class="ruby-identifier">current_user</span>)
144:     <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
145:       <span class="ruby-comment cmt">#debug# html += &quot;&lt;br&gt;#{a.start_date}: #{a.quantity}&quot;</span>
146:       <span class="ruby-identifier">dd</span> = (<span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">first</span> <span class="ruby-value">? </span><span class="ruby-identifier">first_date_in_chart</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">day</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_date</span>)
147:       <span class="ruby-identifier">x2_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">a</span>.<span class="ruby-identifier">quantity</span>.<span class="ruby-identifier">to_s</span>, ] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_sec</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_sec</span>]
148:     <span class="ruby-keyword kw">end</span>
149: 
150:     <span class="ruby-identifier">canvas_height</span> = (<span class="ruby-identifier">y_ticks</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:line</span>][<span class="ruby-identifier">:height</span>])
151:     <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:canvas</span>][<span class="ruby-identifier">:height</span>] = <span class="ruby-identifier">canvas_height</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">canvas_height</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:canvas</span>][<span class="ruby-identifier">:height</span>]
152: 
153: 
154: 
155:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">javascript_include_flotr</span>
156:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_mouse_monitor'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;position: absolute; z-index: 9999; border: 1px solid black; width: 200px;&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-keyword kw">end</span>
157:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_container'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;width:#{config[:canvas][:width]}px;height:#{config[:canvas][:height]}px;&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-keyword kw">end</span>
158:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'buttons'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;text-align: center;&quot;</span> <span class="ruby-keyword kw">do</span>
159:               <span class="ruby-identifier">r</span> = <span class="ruby-value str">&quot;&quot;</span>
160:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_prev'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-node">&quot;&lt; #{_(&quot;Prev&quot;)}&quot;</span> <span class="ruby-keyword kw">end</span>
161:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span>
162:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_next'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-node">&quot;#{_(&quot;Next&quot;)} &gt;&quot;</span> <span class="ruby-keyword kw">end</span>
163:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span>
164:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_zoom_reset'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-node">&quot;#{_(&quot;Reset Zoom&quot;)}&quot;</span> <span class="ruby-keyword kw">end</span>
165:             <span class="ruby-keyword kw">end</span>
166:     
167:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n\nvar canvas_container = $('canvas_container');\n\nfunction draw_canvas(){\n\nvar x_ticks = \#{x_ticks.sort.to_json};\nvar x2_ticks = \#{x2_ticks.sort.to_json};\nvar y_ticks = \#{y_ticks.to_json};\nvar items_users = \#{items_users.to_json};\n\n//old//x2_ticks.sort();\n\nvar options = {\nxaxis:{\ntitle: '\#{config[:title][:xaxis]}',\nticks: x_ticks,\nmin: \#{today.to_time.to_i + config[:range][:start_sec]},\nmax: \#{today.to_time.to_i + config[:range][:end_sec]}\n},\nx2axis:{\ntitle: '\#{config[:title][:x2axis]}',\nticks: x2_ticks,\nmin: \#{today.to_time.to_i + config[:range][:start_sec]},\nmax: \#{today.to_time.to_i + config[:range][:end_sec]}\n},\nyaxis:{\ntitle: '', //'\#{config[:title][:yaxis]}',\nticks: y_ticks,\nmin: 0,\nmax: y_ticks.length + 1\n},\ngrid:{\n//verticalLines: false,\nhorizontalLines: false,\nbackgroundColor: '#ffffff',\ntickColor: '#dddddd'\n},\nlines: {\nlineWidth: 5\n},\nselection: {\nmode: 'x',     // =&gt; null, 'x', 'y' or 'xy'\ncolor: '#B6D9FF',   // =&gt; color of the selection box\nfps: 10     // =&gt; frames-per-second to draw the selection box.\n},\nmouse: {\ntrack: true,    // =&gt; true to track mouse\nposition: 'ne',   // =&gt; position to show the track value box\nrelative: false,\ntrackFormatter: function(obj){\nif (items_users[y_ticks[(obj.y)-1][1]][obj.x].length &gt; 1)\n{\nvar username = items_users[y_ticks[(obj.y)-1][1]][obj.x][0];\nvar userphone = items_users[y_ticks[(obj.y)-1][1]][obj.x][1];\nvar other_val = items_users[y_ticks[(obj.y)-1][1]][obj.x][2];\n}\nelse\n{\nvar other_val = items_users[y_ticks[(obj.y)-1][1]][obj.x][0]\nvar username = items_users[y_ticks[(obj.y)-1][1]][other_val][0];\nvar userphone = items_users[y_ticks[(obj.y)-1][1]][other_val][1];\n}\nif (obj.x &lt; other_val)\n{ var from_date = obj.x;\nvar to_date = other_val; }\nelse\n{ var from_date = other_val;\nvar to_date = obj.x; }\nreturn y_ticks[(obj.y)-1][1] + '&lt;br/&gt;' + show_date(new Date(from_date * 1000),false) + ' - ' + show_date(new Date(to_date * 1000),false) + '&lt;br/&gt;Client: ' + username + '&lt;br/&gt;Phone: ' + userphone;\n},\nmargin: 5,    // =&gt; margin for the track value box\ncolor: '#ff3f19', // =&gt; color for the tracking points, null to hide points\ntrackDecimals: 0, // =&gt; number of decimals for track values\nradius: 3,    // =&gt; radius of the tracking points\nsensibility: 2    // =&gt; the smaller this value, the more precise you've to point with the mouse\n}\n};\n\nfunction drawGraph(opts){\nvar o = Object.extend(Object.clone(options), opts || {});\nreturn Flotr.draw(canvas_container,\n\#{data.to_json},\no);\n}\n\nvar f = drawGraph();\n\ncanvas_container.observe('flotr:select', function(evt){\nvar area = evt.memo[0];\n\nf = drawGraph({\nxaxis:{\ntitle: f.axes.x.options.title, // forwarding value\nticks: f.axes.x.options.ticks, // forwarding value\nmin:area.x1,\nmax:area.x2\n},\nx2axis:{\ntitle: f.axes.x2.options.title, // forwarding value\nticks: f.axes.x2.options.ticks, // forwarding value\nmin:area.x1,\nmax:area.x2\n}\n});\n});\n\n\nfunction canvas_navigate(delta_days){\ndelta_days = delta_days * 86400;\n\nf = drawGraph({\nxaxis:{\ntitle: f.axes.x.options.title, // forwarding value\nticks: f.axes.x.options.ticks, // forwarding value\nmin: f.axes.x.min + delta_days,\nmax: f.axes.x.max + delta_days\n},\nx2axis:{\ntitle: f.axes.x2.options.title, // forwarding value\nticks: f.axes.x2.options.ticks, // forwarding value\nmin: f.axes.x2.min + delta_days,\nmax: f.axes.x2.max + delta_days\n}\n});\n}\n\n$('canvas_prev').observe('click', function(evt){ canvas_navigate(-30); });\n$('canvas_next').observe('click', function(evt){ canvas_navigate(30); });\n$('canvas_zoom_reset').observe('click', function(){drawGraph()});\n\ncanvas_container.observe('flotr:mousemove', function(evt){\nvar x_timestamp = evt.memo[1].x2;\nvar mouse_monitor_x = evt.memo[1].absX + 15;\nvar mouse_monitor_y = evt.memo[1].absY + 15;\nvar canvas_mouse_monitor = $('canvas_mouse_monitor');\nfor(var i = x2_ticks.length - 1; i &gt; 0 &amp;&amp; x2_ticks[i][0] &gt; evt.memo[1].x2; i--);\ncanvas_mouse_monitor.innerHTML = '&lt;h4&gt;' + show_date(new Date(x_timestamp * 1000),true) + '&lt;br/&gt;available: ' + x2_ticks[i][1] + '&lt;/h4&gt;';\ncanvas_mouse_monitor.style.left = mouse_monitor_x + 'px';\ncanvas_mouse_monitor.style.top = mouse_monitor_y + 'px';\n});\n\n}\n\ndocument.observe('dom:loaded', function(evt){ draw_canvas(); });\n\n&lt;/script&gt;\n&quot;</span>
168:     
169:     <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'flotr_container'</span> <span class="ruby-keyword kw">do</span>
170:       <span class="ruby-identifier">html</span>
171:     <span class="ruby-keyword kw">end</span>
172:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000402" class="method-detail">
        <a name="M000402"></a>

        <div class="method-heading">
          <a href="#M000402" class="method-signature">
          <span class="method-name">canvas_for_model_in_inventory_pools</span><span class="method-args">(model, inventory_pools = [])</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
TODO DRY with <a href="ModelsHelper.html#M000401">canvas_for_model</a>
method Flotr Javascript Library required
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000402-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000402-source">
<pre>
     <span class="ruby-comment cmt"># File app/helpers/models_helper.rb, line 325</span>
325:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">canvas_for_model_in_inventory_pools</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">inventory_pools</span> = [])
326:     <span class="ruby-identifier">config</span> = {<span class="ruby-identifier">:canvas</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">800</span>, <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">160</span>},
327:               <span class="ruby-identifier">:line</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span>},
328:               <span class="ruby-identifier">:range</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:start_days</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">:end_days</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">200</span>},
329:               <span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:xaxis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-value str">'Time'</span>), <span class="ruby-identifier">:x2axis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-value str">'Available Quantity'</span>), <span class="ruby-identifier">:yaxis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">_</span>(<span class="ruby-value str">'Inventory Pools'</span>)}
330:               }
331:     <span class="ruby-identifier">inventory_pools</span> <span class="ruby-operator">&amp;=</span> <span class="ruby-identifier">model</span>.<span class="ruby-identifier">inventory_pools</span>
332:     <span class="ruby-identifier">canvas_height</span> = (<span class="ruby-identifier">inventory_pools</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:line</span>][<span class="ruby-identifier">:height</span>])
333:     <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:canvas</span>][<span class="ruby-identifier">:height</span>] = <span class="ruby-identifier">canvas_height</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">canvas_height</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:canvas</span>][<span class="ruby-identifier">:height</span>]
334:     <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_sec</span>] = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_days</span>] <span class="ruby-operator">*</span> <span class="ruby-value">86400</span>
335:     <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_sec</span>] = <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_days</span>] <span class="ruby-operator">*</span> <span class="ruby-value">86400</span>
336: 
337:     <span class="ruby-identifier">today</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
338:     <span class="ruby-identifier">x_ticks</span> = [[<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value str">'^'</span>]]
339:     <span class="ruby-identifier">x2_ticks</span> = [[<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value str">'.'</span>]] <span class="ruby-comment cmt"># TODO compute total availables</span>
340:     <span class="ruby-identifier">y_ticks</span> = []
341:     <span class="ruby-identifier">data</span> = []
342:     <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> [[<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">0</span>], [<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">0</span>]], <span class="ruby-identifier">:xaxis</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>} <span class="ruby-comment cmt"># NOTE forcing to render x2axis</span>
343:     <span class="ruby-identifier">html</span> = <span class="ruby-value str">&quot;&quot;</span>
344:     <span class="ruby-identifier">all_availabilities</span> = []
345:     <span class="ruby-identifier">first_date_in_chart</span> = (<span class="ruby-identifier">today</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_days</span>].<span class="ruby-identifier">days</span>)
346:     
347:     <span class="ruby-identifier">dd</span> = <span class="ruby-identifier">first_date_in_chart</span>.<span class="ruby-identifier">at_beginning_of_month</span>
348:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_sec</span>] <span class="ruby-keyword kw">do</span>
349:       <span class="ruby-identifier">x_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%b&quot;</span>)] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_sec</span>] 
350:       <span class="ruby-identifier">dd</span> = <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">next_month</span>
351:     <span class="ruby-keyword kw">end</span>
352:     
353:     
354:     <span class="ruby-identifier">inventory_pools</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">inventory_pool</span>, <span class="ruby-identifier">index</span><span class="ruby-operator">|</span>
355:       <span class="ruby-identifier">y</span> = <span class="ruby-identifier">index</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
356:       <span class="ruby-identifier">y_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">y</span>, <span class="ruby-identifier">inventory_pool</span>.<span class="ruby-identifier">name</span>]
357: 
358:       <span class="ruby-identifier">availability</span> = <span class="ruby-identifier">model</span>.<span class="ruby-identifier">available_periods_for_inventory_pool</span>(<span class="ruby-identifier">inventory_pool</span>, <span class="ruby-identifier">current_user</span>)
359:       <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
360:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">quantity</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
361: <span class="ruby-comment cmt"># TODO ????       next a.end_date &lt; a.start_date if a.end_date</span>
362:         <span class="ruby-identifier">all_availabilities</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>
363:         <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> { <span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> [[<span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">y</span>], [(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_date</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">year</span>).<span class="ruby-identifier">tomorrow</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">y</span>]],
364:                   <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'#e3aa01'</span>,
365:                   <span class="ruby-identifier">:lines</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:lineWidth</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">a</span>.<span class="ruby-identifier">quantity</span>, <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:line</span>][<span class="ruby-identifier">:height</span>]].<span class="ruby-identifier">min</span>} }
366:       <span class="ruby-keyword kw">end</span>
367:     <span class="ruby-keyword kw">end</span>
368: 
369:     <span class="ruby-identifier">availability</span> = <span class="ruby-constant">Availability</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>, <span class="ruby-identifier">model</span>, <span class="ruby-identifier">all_availabilities</span>)
370:     <span class="ruby-identifier">quantity_periods</span> = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">periods</span>
371:     <span class="ruby-identifier">quantity_periods</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
372:       <span class="ruby-identifier">dd</span> = (<span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">quantity_periods</span>.<span class="ruby-identifier">first</span> <span class="ruby-value">? </span><span class="ruby-identifier">first_date_in_chart</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">day</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_date</span>)
373:       <span class="ruby-identifier">x2_ticks</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">a</span>.<span class="ruby-identifier">quantity</span>.<span class="ruby-identifier">abs</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:start_sec</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">dd</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">config</span>[<span class="ruby-identifier">:range</span>][<span class="ruby-identifier">:end_sec</span>]
374:     <span class="ruby-keyword kw">end</span>
375: 
376: 
377:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">javascript_include_flotr</span>
378: 
379:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_mouse_monitor'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;position: absolute; z-index: 9999; border: 1px solid black; width: 200px;&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-keyword kw">end</span>
380: 
381:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_container'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;width:#{config[:canvas][:width]}px;height:#{config[:canvas][:height]}px;&quot;</span> <span class="ruby-keyword kw">do</span> <span class="ruby-keyword kw">end</span>
382: 
383:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'buttons'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;text-align: center;&quot;</span> <span class="ruby-keyword kw">do</span>
384:               <span class="ruby-identifier">r</span> = <span class="ruby-value str">&quot;&quot;</span>
385:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_prev'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-node">&quot;&lt; #{_(&quot;Prev&quot;)}&quot;</span> <span class="ruby-keyword kw">end</span>
386:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot; &quot;</span>
387:               <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_next'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-node">&quot;#{_(&quot;Next&quot;)} &gt;&quot;</span> <span class="ruby-keyword kw">end</span>
388:               <span class="ruby-identifier">r</span>
389:             <span class="ruby-keyword kw">end</span>
390:     
391:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;\n\nvar canvas_container = $('canvas_container');\n\nfunction draw_canvas(){\n\nvar x_ticks = \#{x_ticks.sort.to_json};\nvar x2_ticks = \#{x2_ticks.sort.to_json};\nvar y_ticks = \#{y_ticks.to_json};\n\nvar options = {\nxaxis:{\ntitle: '\#{config[:title][:xaxis]}',\nticks: x_ticks,\nmin: \#{today.to_time.to_i + config[:range][:start_sec]},\nmax: \#{today.to_time.to_i + config[:range][:end_sec]}\n},\nx2axis:{\ntitle: '\#{config[:title][:x2axis]}',\nticks: x2_ticks,\nmin: \#{today.to_time.to_i + config[:range][:start_sec]},\nmax: \#{today.to_time.to_i + config[:range][:end_sec]}\n},\nyaxis:{\ntitle: '\#{config[:title][:yaxis]}',\nticks: y_ticks,\nmin: 0,\nmax: y_ticks.length + 1\n},\ngrid:{\nhorizontalLines: false,\nbackgroundColor: '#ffffff'\n},\nselection: {\nmode: 'x',     // =&gt; null, 'x', 'y' or 'xy'\ncolor: '#B6D9FF',   // =&gt; color of the selection box\nfps: 10     // =&gt; frames-per-second to draw the selection box.\n},\nmouse: {\ntrack: false,    // =&gt; true to track mouse\nposition: 'ne',   // =&gt; position to show the track value box\nrelative: false,\ntrackFormatter: function(obj){ return y_ticks[obj.y][1] + '&lt;br/&gt;' + show_date(new Date(obj.x * 1000)); },\nmargin: 5,    // =&gt; margin for the track value box\ncolor: '#ff3f19', // =&gt; color for the tracking points, null to hide points\ntrackDecimals: 0, // =&gt; number of decimals for track values\nradius: 3,    // =&gt; radius of the tracking points\nsensibility: 2    // =&gt; the smaller this value, the more precise you've to point with the mouse\n}\n};\n\nfunction drawGraph(opts){\nvar o = Object.extend(Object.clone(options), opts || {});\nreturn Flotr.draw(canvas_container,\n\#{data.to_json},\no);\n}\n\nvar f = drawGraph();\n\n\nfunction canvas_navigate(delta_days){\ndelta_days = delta_days * 86400;\n\nf = drawGraph({\nxaxis:{\ntitle: f.axes.x.options.title, // forwarding value\nticks: f.axes.x.options.ticks, // forwarding value\nmin: f.axes.x.min + delta_days,\nmax: f.axes.x.max + delta_days\n},\nx2axis:{\ntitle: f.axes.x2.options.title, // forwarding value\nticks: f.axes.x2.options.ticks, // forwarding value\nmin: f.axes.x2.min + delta_days,\nmax: f.axes.x2.max + delta_days\n}\n});\n}\n\n$('canvas_prev').observe('click', function(evt){ canvas_navigate(-30); });\n$('canvas_next').observe('click', function(evt){ canvas_navigate(30); });\n\ncanvas_container.observe('flotr:mousemove', function(evt){\nvar x_timestamp = evt.memo[1].x2;\nvar mouse_monitor_x = evt.memo[1].absX + 15;\nvar mouse_monitor_y = evt.memo[1].absY + 15;\nvar canvas_mouse_monitor = $('canvas_mouse_monitor');\nfor(var i = x2_ticks.length - 1; i &gt; 0 &amp;&amp; x2_ticks[i][0] &gt; evt.memo[1].x2; i--);\ncanvas_mouse_monitor.innerHTML = '&lt;h4&gt;' + show_date(new Date(x_timestamp * 1000)) + '&lt;br/&gt;available: ' + x2_ticks[i][1] + '&lt;/h4&gt;';\ncanvas_mouse_monitor.style.left = mouse_monitor_x + 'px';\ncanvas_mouse_monitor.style.top = mouse_monitor_y + 'px';\n});\n\n}\n\ndocument.observe('dom:loaded', function(evt){ draw_canvas(); });\n\n&lt;/script&gt;\n&quot;</span>
392:     
393:     <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'flotr_container'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;width:#{config[:canvas][:width]}px;&quot;</span> <span class="ruby-keyword kw">do</span>
394:       <span class="ruby-identifier">html</span>
395:     <span class="ruby-keyword kw">end</span>
396:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000399" class="method-detail">
        <a name="M000399"></a>

        <div class="method-heading">
          <a href="#M000399" class="method-signature">
          <span class="method-name">javascript_include_flotr</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000399-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000399-source">
<pre>
    <span class="ruby-comment cmt"># File app/helpers/models_helper.rb, line 3</span>
 3:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">javascript_include_flotr</span>
 4:     <span class="ruby-identifier">r</span> = <span class="ruby-value str">&quot;&quot;</span>
 5: <span class="ruby-comment cmt">#    r += javascript_include_tag :defaults</span>
 6: 
 7: <span class="ruby-comment cmt">#    r += javascript_include_tag &quot;flotr/lib/prototype-1.6.0.2.js&quot;</span>
 8: <span class="ruby-comment cmt">#    r += javascript_include_tag &quot;flotr/lib/excanvas.js&quot; # IE</span>
 9: <span class="ruby-comment cmt">#    r += javascript_include_tag &quot;flotr/lib/base64.js&quot; # IE</span>
10: <span class="ruby-comment cmt">#    r += javascript_include_tag &quot;flotr/lib/canvas2image.js&quot;</span>
11: <span class="ruby-comment cmt">#    r += javascript_include_tag &quot;flotr/lib/canvastext.js&quot;</span>
12: 
13:     <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">javascript_include_tag</span> <span class="ruby-value str">&quot;flotr/flotr.js&quot;</span>
14:     <span class="ruby-identifier">r</span>
15:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000403" class="method-detail">
        <a name="M000403"></a>

        <div class="method-heading">
          <a href="#M000403" class="method-signature">
          <span class="method-name">pie_for_model</span><span class="method-args">(model)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Flotr Javascript Library required
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000403-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000403-source">
<pre>
     <span class="ruby-comment cmt"># File app/helpers/models_helper.rb, line 501</span>
501:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pie_for_model</span>(<span class="ruby-identifier">model</span>)
502:     <span class="ruby-identifier">config</span> = {<span class="ruby-identifier">:canvas</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">800</span>, <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">300</span>}}
503: 
504:     <span class="ruby-identifier">data</span> = []
505:     <span class="ruby-identifier">model</span>.<span class="ruby-identifier">inventory_pools</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ip</span><span class="ruby-operator">|</span>
506:       <span class="ruby-identifier">n</span> = <span class="ruby-identifier">ip</span>.<span class="ruby-identifier">items</span>.<span class="ruby-identifier">scoped_by_model_id</span>(<span class="ruby-identifier">model</span>).<span class="ruby-identifier">count</span>
507:       <span class="ruby-identifier">data</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-identifier">:data</span> =<span class="ruby-operator">&gt;</span> [[<span class="ruby-value">0</span>, <span class="ruby-identifier">n</span>]], <span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ip</span>.<span class="ruby-identifier">name</span>}
508:     <span class="ruby-keyword kw">end</span>
509:     
510:     <span class="ruby-identifier">html</span> = <span class="ruby-value str">&quot;&quot;</span>
511:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">javascript_include_flotr</span>
512:   
513:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">content_tag</span> <span class="ruby-identifier">:div</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'canvas_container'</span>, <span class="ruby-identifier">:style</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;width:#{config[:canvas][:width]}px;height:#{config[:canvas][:height]}px;&quot;</span> <span class="ruby-keyword kw">do</span>
514:             <span class="ruby-keyword kw">end</span>
515: 
516:     <span class="ruby-identifier">html</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">javascript_tag</span> <span class="ruby-keyword kw">do</span>
517:       <span class="ruby-value str">&quot;var canvas_container = $('canvas_container');\n\nfunction draw_canvas(){\nvar f = Flotr.draw(canvas_container,\n\#{data.to_json},\n{\ngrid: {\nverticalLines: false,\nhorizontalLines: false\n},\nxaxis: {showLabels: false},\nyaxis: {showLabels: false},\nlegend:{show: false},\npie: {\nshow: true,           // =&gt; setting to true will show bars, false will hide\n//lineWidth: 1,          // =&gt; in pixels\n//fill: true,            // =&gt; true to fill the area from the line to the x axis, false for (transparent) no fill\n//fillColor: null,       // =&gt; fill color\n//fillOpacity: 0.6,      // =&gt; opacity of the fill color, set to 1 for a solid fill, 0 hides the fill\n//explode: 6,\n//sizeRatio: 0.6,\n//startAngle: Math.PI/4,\nlabelFormatter: function(slice) { return slice.name + ' (' + slice.y + ')'; },\n//pie3D: false,\n//pie3DviewAngle: (Math.PI/2 * 0.8),\n//pie3DspliceThickness: 20\n}\n});\n}\n\ndocument.observe('dom:loaded', draw_canvas());\n\n&quot;</span>
518:     <span class="ruby-keyword kw">end</span>
519:     
520:     <span class="ruby-identifier">html</span>
521:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>