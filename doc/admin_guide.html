<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<title>leihs administration and installation guide</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}


@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>leihs administration and installation guide</h1>
<span id="author">Ramon Cahenzli</span><br />
<span id="email"><tt>&lt;<a href="mailto:ramon.cahenzli@zhdk.ch">ramon.cahenzli@zhdk.ch</a>&gt;</tt></span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>leihs is web-based inventory handling and resource booking system. It allows users to view available equipment and place reservations through the frontend. Inventory managers and sysadmins use the backend to handle incoming reservations and manage items in the inventory.</p></div>
<div class="paragraph"><p>This guide shows you how to install a leihs server. The guide is written from the perspective of a system administrator or developer. If you are interested in running leihs in your own organization but aren&#8217;t a sysadmin, talk to your IT department. leihs is not intended to be installed on a client, so any software installation on your own machine isn&#8217;t necessary. All you need is a web browser.</p></div>
<div class="paragraph"><p>Consulting and installation services are also available from independent companies supporting Free Software all around the world. Ask around for a company or individual who knows Ruby on Rails applications, you will surely find someone who can help you install leihs.</p></div>
<div class="paragraph"><p>If you are such a person yourself and would like to have your services listed on the leihs project website and in this document, please write me an e-mail.</p></div>
</div>
<h2 id="_quick_install">Quick Install</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section is meant for admins experienced with installing Ruby on Rails applications. It lists the necessary installation steps in the briefest possible way, so you can get up and running quickly.</p></div>
<h3 id="_installation_on_mac_os_x">Installation on Mac OS X</h3><div style="clear:left"></div>
<div class="paragraph"><p>The following steps were tested on Mac OS X 10.5 and 10.6 on an x86. They may also work for later versions.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Install Apple Xcode. This is required because some modules may need a C/C++ compiler. XCode is <a href="http://developer.apple.com/Tools/">available from Apple</a> after a free developer registration.
</p>
</li>
<li>
<p>
Install MySQL 5.0. Use the 32-bit version if you are running OS X Leopard (10.5) but use the 64-bit version if you&#8217;re on Snow Leopard (10.6). <strong>Make absolutely sure to install the 32-bit version on Leopard (10.5) even if you are running a 64-bit operating system.</strong> Some bugs in Mac OS X&#8217;s MySQL and Ruby integration make it impossible to continue otherwise.
</p>
</li>
<li>
<p>
Update the local gem system:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ sudo gem update --system</tt></pre>
</div></div>
</li>
<li>
<p>
Install the native MySQL gem:
</p>
<div class="paragraph"><p>If you are installing on Snow Leopard (OS X 10.6) use the following installation options:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt> $ sudo env ARCHFLAGS='-arch x86_64' \
gem install mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config</tt></pre>
</div></div>
<div class="paragraph"><p>If you are using Leopard (OS X 10.5) or below, use the following string instead:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt> $ sudo gem install mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config \
--with-mysql-dir=/usr/local/mysql --with-mysql-lib=/usr/local/mysql/lib
\ --with-mysql-include=/usr/local/mysql/include</tt></pre>
</div></div>
</li>
<li>
<p>
Download the latest version of leihs from our <a href="http://sourceforge.net/projects/leihs">SourceForge project page</a>. Unpack it to a convenient directory. We use the home directory of the <em>leihs</em> user (/Users/leihs) to install leihs in. Of course you can use any directory.
</p>
</li>
<li>
<p>
Configure database access for this installation of leihs. Copy the file config/database.yml.example to config/database.yml and set things up according to your needs. You will need a MySQL database for leihs. Here is an example of a development-mode database configuration:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>production:
   adapter: mysql
   database: leihs2_production
   encoding: utf8
   username: root
   password:
   host: localhost
   port: 3306</tt></pre>
</div></div>
</li>
<li>
<p>
Create and migrate the database:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' rake db:migrate</tt></pre>
</div></div>
</li>
<li>
<p>
Create any temporary directories that are necessary for e.g. image uploads, temporary files etc. Make sure to create these directories so that the leihs user has write permission to them.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /home/leihs
$ mkdir -p public/images/attachments
$ mkdir -p tmp/sessions
$ mkdir tmp/cache
$ mkdir -p log</tt></pre>
</div></div>
</li>
<li>
<p>
Download Sphinx (a fulltext search system) and install thinking-sphinx (a gem). In this example we also include libstemmer, a library that allows for word stem searching in various languages. We use version 0.9.9:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /tmp
$ wget http://sphinxsearch.com/downloads/sphinx-0.9.9.tar.gz
$ tar xvfz sphinx-0.9.9.tar.gz
$ cd sphinx-0.9.9
$ wget http://snowball.tartarus.org/dist/libstemmer_c.tgz
$ tar xvfz libstemmer_c.tgz
$ ./configure --with-libstemmer &amp;&amp; make
$ sudo make install
$ sudo gem install thinking-sphinx --source http://gemcutter.org -v 1.3.15</tt></pre>
</div></div>
</li>
<li>
<p>
Install the required version of Rails as well as a few gems that cannot be installed automatically:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /home/leihs
$ sudo gem install -v=2.3.5 rails
$ sudo gem install thinking-sphinx -v 1.3.15
$ sudo gem install prawn -v 0.8.4
$ sudo gem install rake
$ sudo rake gems:install</tt></pre>
</div></div>
</li>
<li>
<p>
Configure and start the Sphinx server:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' rake ts:config
$ RAILS_ENV='production' rake ts:reindex
$ RAILS_ENV='production' rake ts:start</tt></pre>
</div></div>
</li>
<li>
<p>
Start the server:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' ./script/server</tt></pre>
</div></div>
<div class="paragraph"><p>Now you should see your local leihs server at <a href="http://localhost:3000">http://localhost:3000</a>. You can log in with username "super_user_1" and password "pass".</p></div>
<div class="paragraph"><p>This gives you a test setup using the pure Ruby WebRick web server. For production setups, we recommend mod_passenger. See the "Installing a production environment" section of this guide for more information.</p></div>
</li>
<li>
<p>
Set up a system cronjob that sends nightly e-mail reminders and, more importantly, updates all the models' availability counts. There are many ways to schedule repeating tasks on Mac OS X. Please see Apple&#8217;s documentation on launchd for how to do this.
</p>
<div class="paragraph"><p>In crontab format, an example job for a production environment would look like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>1 00    * * *   cd /home/leihs &amp;&amp; RAILS_ENV='production' rake leihs:cron</tt></pre>
</div></div>
<div class="paragraph"><p>The important bit here is to run the "leihs:cron" rake task. How you do this exactly is irrelevant.</p></div>
</li>
<li>
<p>
Optional: If you want to use images of inventory items, install ImageMagick. On Mac OS X, we recommend using MacPorts and then installing the ImageMagick port:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ sudo port install imagemagick</tt></pre>
</div></div>
<div class="paragraph"><p>Make sure that the ImageMagick binaries (e.g. convert) are in your $PATH. Please consult the Mac OS X documentation to find out how to add paths to your $PATH environment variable. It can be done e.g. by editing /etc/profile and adding the following lines:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>PATH=$PATH:/opt/local/bin
export PATH</tt></pre>
</div></div>
<div class="paragraph"><p>But Apple may at any point recommend a different approach for configuring your PATH, so please don&#8217;t take our word for it.</p></div>
<div class="paragraph"><p>Finally, install the rmagick gem:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ sudo gem install rmagick</tt></pre>
</div></div>
</li>
</ol></div>
<h3 id="_installation_on_debian_gnu_linux">Installation on Debian GNU/Linux</h3><div style="clear:left"></div>
<div class="paragraph"><p>These instructions were tested on a minimal install of Debian GNU/Linux 5.0 (Lenny).</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Install Ruby and irb
</p>
<div class="literalblock">
<div class="content">
<pre><tt># apt-get install ruby irb rdoc libopenssl-ruby ruby-dev</tt></pre>
</div></div>
</li>
<li>
<p>
Install RubyGems from <a href="http://rubygems.org/">the RubyGems website</a>. Make sure <strong>not to install</strong> the edition of RubyGems that is available from Debian&#8217;s package archives. RubyGem development moves so quickly that we need to use the one from upstream.
</p>
<div class="literalblock">
<div class="content">
<pre><tt># cd /tmp
# wget http://rubyforge.org/frs/download.php/56227/rubygems-1.3.3.tgz
# tar xvfz rubygems-1.3.3.tgz
# cd rubygems-1.3.3
# ruby setup.rb
# ln -s /usr/bin/gem1.8 /usr/bin/gem</tt></pre>
</div></div>
<div class="paragraph"><p>Note that the URL above might change! Please visit the RubyGems site to find the exact URL under "Downloads".</p></div>
</li>
<li>
<p>
Install the MySQL header files and the MySQL gem:
</p>
<div class="literalblock">
<div class="content">
<pre><tt># apt-get install libmysqlclient15-dev make
# gem install mysql</tt></pre>
</div></div>
</li>
<li>
<p>
Download the latest version of leihs from our <a href="http://sourceforge.net/projects/leihs">SourceForge project page</a>. Unpack it to a convenient directory. We use the home directory of the <em>leihs</em> user (/home/leihs) to install leihs in. Of course you can use any directory.
</p>
</li>
<li>
<p>
Configure database access for this installation of leihs. Copy the file config/database.yml.example to config/database.yml and set things up according to your needs. You will need a MySQL database for leihs. Here is an example of a development-mode database configuration:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>production:
   adapter: mysql
   database: leihs2_production
   encoding: utf8
   username: root
   password:
   host: localhost
   port: 3306</tt></pre>
</div></div>
</li>
<li>
<p>
Create and migrate the database:
</p>
<div class="literalblock">
<div class="content">
<pre><tt># su - leihs
$ RAILS_ENV='production' rake db:migrate</tt></pre>
</div></div>
</li>
<li>
<p>
Create any temporary directories that are necessary for e.g. image uploads, temporary files etc. Make sure to create these directories so that the leihs user has write permission to them.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /home/leihs
$ mkdir -p public/images/attachments
$ mkdir -p tmp/sessions
$ mkdir tmp/cache
$ mkdir -p log</tt></pre>
</div></div>
</li>
<li>
<p>
Download Sphinx (a fulltext search system) and install thinking-sphinx (a gem). In this example we also include libstemmer, a library that allows for word stem searching in various languages. We use version 0.9.9:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /tmp
$ curl -C - -O http://sphinxsearch.com/downloads/sphinx-0.9.9.tar.gz
$ tar xvfz sphinx-0.9.9.tar.gz
$ cd sphinx-0.9.9
$ curl -C - -O http://snowball.tartarus.org/dist/libstemmer_c.tgz
$ tar xvfz libstemmer_c.tgz
$ ./configure --with-libstemmer &amp;&amp; make
$ su
# make install
# gem install thinking-sphinx --source http://gemcutter.org -v 1.3.15</tt></pre>
</div></div>
</li>
<li>
<p>
Install the required version of Rails as well as a few gems that cannot be installed automatically:
</p>
<div class="literalblock">
<div class="content">
<pre><tt># cd /home/leihs
# gem install -v=2.3.5 rails
# gem install thinking-sphinx -v 1.3.15
# gem install prawn -v 0.8.4
# gem install rake
# rake gems:install</tt></pre>
</div></div>
</li>
<li>
<p>
Configure and start the Sphinx server:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /home/leihs
$ RAILS_ENV='production' rake ts:config
$ RAILS_ENV='production' rake ts:reindex
$ RAILS_ENV='production' rake ts:start</tt></pre>
</div></div>
</li>
<li>
<p>
Start the leihs server:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd /home/leihs
$ RAILS_ENV='production' ./script/server</tt></pre>
</div></div>
<div class="paragraph"><p>Now you should see your local leihs server at <a href="http://localhost:3000">http://localhost:3000</a>. You can log in with username "super_user_1" and password "pass".</p></div>
<div class="paragraph"><p>This gives you a test setup using the pure Ruby WebRick web server. For production setups, we recommend mod_passenger. See the "Installing a production environment" section of this guide for more information.</p></div>
</li>
<li>
<p>
Set up a system cronjob that sends nightly e-mail reminders and, more importantly, updates all the models' availability counts. There are many ways to schedule repeating tasks on GNU/Linux, but here&#8217;s a line in crontab-format that you can add to your leihs user&#8217;s crontab using e.g. <tt>crontab -e</tt>:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>1 00    * * *   cd /home/leihs &amp;&amp; RAILS_ENV='production' rake leihs:cron</tt></pre>
</div></div>
<div class="paragraph"><p>The important bit here is to run the "leihs:cron" rake task. How you do this exactly is irrelevant.</p></div>
</li>
<li>
<p>
Optional: If you want to use images of inventory items, install ImageMagick:
</p>
<div class="literalblock">
<div class="content">
<pre><tt># apt-get install imagemagick graphicsmagick-libmagick-dev-compat</tt></pre>
</div></div>
<div class="paragraph"><p>And then install the rmagick gem:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt># gem install rmagick</tt></pre>
</div></div>
</li>
</ol></div>
</div>
<h2 id="_default_admin_username_password">Default admin username/password</h2>
<div class="sectionbody">
<div class="paragraph"><p>After installation, a default user is created for the Database Authentication module. Username: super_user_1. Password: pass.</p></div>
</div>
<h2 id="_upgrading_from_leihs_2_0_to_leihs_2_1">Upgrading from leihs 2.0 to leihs 2.1</h2>
<div class="sectionbody">
<div class="paragraph"><p>The upgrade should be painless.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Download the new leihs version (in this example, the .tar.gz version is used) and unpack it to a new location:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ tar xvfz leihs-2.1.tar.gz
$ cd leihs-2.1</tt></pre>
</div></div>
</li>
<li>
<p>
Copy any images uploaded to your old leihs version so they are also available in the new leihs:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ rm -rf public/images/attachments
$ cp -pr ../leihs-2.0/public/images/attachments public/images/</tt></pre>
</div></div>
</li>
<li>
<p>
Copy your old database configuration file:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cp ../leihs-2.0/config/database.yml config/</tt></pre>
</div></div>
</li>
<li>
<p>
Look at your old config/environment.rb file in a text editor. Open the new config/environment.rb. Copy the configuration items from your old config to your new config as necessary. You might find new options in the new environment.rb that weren&#8217;t present in the old one. Save your new configuration.
</p>
</li>
<li>
<p>
Run the database migration to get all your data up to the new version:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' rake db:migrate</tt></pre>
</div></div>
</li>
<li>
<p>
Rerun the steps from the section "Configure and start the Sphinx server" relevant for your operating system in order to create/update your fulltext search index and make sure Sphinx is running.
</p>
</li>
<li>
<p>
Run the server. Make sure you stop your previous leihs server!
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' ./script/server</tt></pre>
</div></div>
</li>
</ol></div>
<div class="paragraph"><p>If everything went correctly, you should see leihs coming up at <a href="http://localhost:3000">http://localhost:3000</a>.</p></div>
</div>
<h2 id="_upgrading_from_leihs_2_1_to_leihs_2_2">Upgrading from leihs 2.1 to leihs 2.2</h2>
<div class="sectionbody">
<div class="paragraph"><p>The upgrade should be painless.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Download the new leihs version (in this example, the .tar.gz version is used) and unpack it to a new location:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ tar xvfz leihs-2.2.tar.gz
$ cd leihs-2.2</tt></pre>
</div></div>
</li>
<li>
<p>
Copy any images uploaded to your old leihs version so they are also available in the new leihs:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ rm -rf public/images/attachments
$ cp -pr ../leihs-2.1/public/images/attachments public/images/</tt></pre>
</div></div>
</li>
<li>
<p>
Copy your old database configuration file:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cp ../leihs-2.1/config/database.yml config/</tt></pre>
</div></div>
</li>
<li>
<p>
Look at your old config/environment.rb file in a text editor. Open the new config/environment.rb. Copy the configuration items from your old config to your new config as necessary. You might find new options in the new environment.rb that weren&#8217;t present in the old one. Save your new configuration.
</p>
</li>
<li>
<p>
Run the database migration to get all your data up to the new version:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' rake db:migrate</tt></pre>
</div></div>
</li>
<li>
<p>
Run the server. Make sure you stop your previous leihs server!
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' ./script/server</tt></pre>
</div></div>
</li>
</ol></div>
<div class="paragraph"><p>If everything went correctly, you should see leihs coming up at <a href="http://localhost:3000">http://localhost:3000</a>.</p></div>
</div>
<h2 id="_upgrading_from_leihs_2_2_to_leihs_2_3">Upgrading from leihs 2.2 to leihs 2.3</h2>
<div class="sectionbody">
<div class="paragraph"><p>The upgrade should be painless, but please note that the access levels were replaced by user groups in this release. This can give you almost the same behavior, but it&#8217;s different to manage. You now specify groups in the admin interface or your inventory pool&#8217;s backend, and then specify how many items of each model that each group can have.</p></div>
<div class="paragraph"><p>If you had existing user levels in your system, these will be automatically converted to user groups during the database migration (db:migrate). This is documented below.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Download the new leihs version (in this example, the .tar.gz version is used) and unpack it to a new location:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ tar xvfz leihs-2.3.tar.gz
$ cd leihs-2.3</tt></pre>
</div></div>
</li>
<li>
<p>
Copy any images uploaded to your old leihs version so they are also available in the new leihs:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ rm -rf public/images/attachments
$ cp -pr ../leihs-2.2/public/images/attachments public/images/</tt></pre>
</div></div>
</li>
<li>
<p>
Copy your old database configuration file:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cp ../leihs-2.2/config/database.yml config/</tt></pre>
</div></div>
</li>
<li>
<p>
Look at your old config/environment.rb file in a text editor. Open the new config/environment.rb. Copy the configuration items from your old config to your new config as necessary. You might find new options in the new environment.rb that weren&#8217;t present in the old one. Save your new configuration.
</p>
</li>
<li>
<p>
Run the database migration to get all your data up to the new version:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' rake db:migrate</tt></pre>
</div></div>
</li>
<li>
<p>
Run the server. Make sure you stop your previous leihs server! If you use mod_passenger, do <tt>touch tmp/restart.txt</tt> instead.
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ RAILS_ENV='production' ./script/server</tt></pre>
</div></div>
</li>
<li>
<p>
Stop the Sphinx server that&#8217;s running for leihs 2.2.:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd leihs-2.2
$ RAILS_ENV=production rake ts:stop</tt></pre>
</div></div>
</li>
<li>
<p>
Reindex Sphinx at the new location and restart the Sphinx server:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>$ cd leihs-2.3
$ RAILS_ENV=production rake ts:config
$ RAILS_ENV=production rake ts:reindex
$ RAILS_ENV=production rake ts:start</tt></pre>
</div></div>
</li>
</ol></div>
<div class="paragraph"><p>If everything went correctly, you should see leihs coming up at <a href="http://localhost:3000">http://localhost:3000</a> or, if using mod_passenger, at the location you configured.</p></div>
</div>
<h2 id="_installing_a_production_environment">Installing a production environment</h2>
<div class="sectionbody">
<div class="paragraph"><p>Please note that this quick-start guide does not cover running a Ruby on Rails application for production. Please look into <a href="http://www.modrails.com/">Phusion Passenger</a> or the Apache Mongrel cluster in the reference section for how to set up a production environment.</p></div>
<div class="paragraph"><p>Without a real production environment, leihs can handle upwards of 1000 users (not concurrently, of course!). If you need better performance or want an easier to handle setup, you must set up a proper production environment.</p></div>
</div>
<h2 id="_free_software_statement">Free Software Statement</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Zurich University of the Arts supports Free Software <a href="http://www.gnu.org/philosophy/free-sw.html">as defined by the Free Software Foundation</a>. That&#8217;s why leihs is Free Software licensed under the GNU GPL version 3.0.</p></div>
<div class="paragraph"><p>One of the advantages this freedom brings with it is that it enables anyone in the world to provide local support services for leihs at the same quality level as the Zurich University of the Arts can provide itself.</p></div>
<div class="paragraph"><p>If you would like to take part in the development of leihs, please see our <a href="http://code.zhdk.ch/projects/leihs">project page</a>.</p></div>
</div>
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="paragraph"><p>Setting up production environments with Rails:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://www.modrails.com/">http://www.modrails.com/</a>
</p>
</li>
<li>
<p>
<a href="http://blog.codahale.com/2006/06/19/time-for-a-grown-up-server-rails-mongrel-apache-capistrano-and-you/">http://blog.codahale.com/2006/06/19/time-for-a-grown-up-server-rails-mongrel-apache-capistrano-and-you/</a>
</p>
</li>
</ul></div>
</div>
<h2 id="_appendix_a_zhdk_configuration_file_for_mongrel_cluster">Appendix A: ZHdK configuration file for mongrel cluster</h2>
<div class="sectionbody">
<div class="paragraph"><p>As an example to help you set up a production environment, here is the Apache configuration we use. You will need mod_proxy:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>&lt;VirtualHost *:80&gt;
   ServerName ausleihe.zhdk.ch

   DocumentRoot /home/rails/leihs/leihs/public/
   ErrorLog /var/log/apache2/leihs/error.log

   # Which Rails environment to use (production, testing, production)
   DefaultInitEnv RAILS_ENV production
   SetEnv RAILS_ENV production

  # Proxy balancer for leihs
  &lt;Proxy balancer://leihs_cluster&gt;
    BalancerMember http://127.0.0.1:10010
    BalancerMember http://127.0.0.1:10011
    BalancerMember http://127.0.0.1:10012
    BalancerMember http://127.0.0.1:10013
  &lt;/Proxy&gt;


   # We want to completely ignore the application's own
   # .htaccess, as all relevant options are configured
   # right here in this file.
   &lt;Directory /home/rails/leihs/leihs/public&gt;
      AllowOverride none
   &lt;/Directory&gt;


   # Don't do forward proxying
   ProxyRequests Off

   # Enable reverse proxying
   &lt;Proxy *&gt;
     Order deny,allow
     Allow from all
   &lt;/Proxy&gt;

   RewriteEngine On

   # Check for maintenance file. Let apache load it if it exists
   RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
   RewriteRule . /system/maintenance.html [L]

   # Rewrite index to check for static
   RewriteRule ^/$ /index.html [QSA]

   # Let apache serve static files (send everything via mod_proxy that
   # is *no* static file (!-f)
   RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
   RewriteRule .* balancer://leihs_cluster%{REQUEST_URI} [L,P,QSA]
&lt;/VirtualHost&gt;</tt></pre>
</div></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2010-10-11 13:47:12 CEST
</div>
</div>
</body>
</html>
