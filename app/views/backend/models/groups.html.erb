<% content_tag :h3 do %>
	<%= _("Current group quantities") %>
<% end %>

<% form_tag url_for({ }) do
	content_tag :table, :id => "groups" do
		content_tag :tr do
			content_tag :th do %>
			<% end
			content_tag :th do %>
				<%= _("Borrowable (%d)") % current_inventory_pool.items.borrowable.scoped_by_model_id(@model).count %>
			<% end
			content_tag :th do %>
				<%= _("Unborrowable (%d)") % current_inventory_pool.items.unborrowable.scoped_by_model_id(@model).count %>
			<% end
		end
		content_tag :tr do
			content_tag :td do %>
				<%= _("General") %>:
			<% end
			content_tag :td, :id => "general_in_stock" do %>
				<%= @defined_change.general_borrowable_size %>
			<% end
			content_tag :td do %>
			<% end
		end
		current_inventory_pool.groups.each do |group|
			content_tag :tr do
				content_tag :td do %>
					<%= group %>:
				<% end
				content_tag :td do
					quantity = @defined_change.total_in_group(group) %>
					<%= text_field_tag "groups[#{group.id}]", quantity %>
				<% end
				content_tag :td do %>
				<% end
			end
		end
	end %>
	
	<%= submit_tag _("Submit") %>		
<% end %>


<% javascript_tag do %>
	jQuery(document).ready(function($){
		var general_in_stock = $("td#general_in_stock");
		$("#groups input").change(function(){
			var rest = <%= current_inventory_pool.items.borrowable.scoped_by_model_id(@model).count %>;
			$("#groups input").each(function(){
				var val = $(this).val() * 1; 
				rest -=  val;
				(val < 0 ? $(this).addClass("valid_false") : $(this).removeClass("valid_false"));
			});
			general_in_stock.html(rest);
			(rest < 0 ? general_in_stock.addClass("valid_false") : general_in_stock.removeClass("valid_false"));
		});
	});
<% end %>

<%= groups_chart(@model, current_inventory_pool) %>

<% changes = @model.availability_changes.scoped_by_inventory_pool_id(current_inventory_pool) %>
<%= availability_changes(changes) %>
