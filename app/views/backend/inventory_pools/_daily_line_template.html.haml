%script#daily_line_template{:type => "text/x-jquery-tmpl"}
  
  %ul{:class => "item{{if $item.overdue }} overdue{{/if}}"}
      
    -# NAME #####################
    
    = link_to "#{user_link_prefix}${user.id}" do
      %li.name
        ${user.firstname}
        ${user.lastname}
    
    
    -# QUANTITY #####################
    
    {{if $item.type == "order"}}
    ${$link = "#{user_link_prefix}"+user.id+"#{acknowledge_postfix}"+id, ""}
    {{/if}}
    
    {{if $item.type == "hand_over"}}
    ${$link = "#{user_link_prefix}"+user.id+"#{hand_over_postfix}", ""}
    {{/if}}
    
    {{if $item.type == "take_back"}}
    ${$link = "#{user_link_prefix}"+user.id+"#{take_back_postfix}", ""}
    {{/if}}

    = link_to "${$link}" do
      %li.quantity
        
        .tip_target
        
        -# QUANTITY NUMBER #####################
        
        %span.number
          ${quantity}
          
        -# QUANTITY NUMBER #####################
        
        %span.text
          = _("Items")
          
        -# QUANTITY TIP #####################
        
        .tip
          %table
            
            {{if order_lines}}
            ${$lines = order_lines, ""}
            {{/if}}
            
            {{if contract_lines}}
            ${$lines = contract_lines, ""}
            {{/if}}
            
            {{each(i, line) $lines}}
            %tr
              %td.quantity
                ${line.quantity}
              %td.model_name
                %span.text
                  {{html String(line.model.name).substring(0, DailyView.tip_modelname_max) }}
                  {{if String(line.model.name).length > DailyView.tip_modelname_max}}
                  {{html "..."}}
                  {{/if}}
              %td.start_date
                {{html formatDate(new Date(line.start_date.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
              %td.date_connector
                = "-"
              %td.end_date
                {{html formatDate(new Date(line.end_date.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
            {{/each}}
            
    -# RANGE #####################
    
    {{if $item.type == "order"}}
    ${$link = "#{user_link_prefix}"+user.id+"#{acknowledge_postfix}"+id, ""}
    {{/if}}
    
    {{if $item.type == "hand_over"}}
    ${$link = "#{user_link_prefix}"+user.id+"#{hand_over_postfix}", ""}
    {{/if}}
    
    {{if $item.type == "take_back"}}
    ${$link = "#{user_link_prefix}"+user.id+"#{take_back_postfix}", ""}
    {{/if}}
    
    = link_to "${$link}" do
      %li.range
        
        -# RANGE NUMBER #####################
        
        %span.number
          
          {{if $item.type == "order"}}
          ${max_single_range}
          {{/if}}
          
          {{if $item.type == "hand_over"}}
          {{if $item.overdue}}
          ${Math.round((new Date() - new Date(date.replace(/-/g, "/"))) / (1000 * 60 * 60 * 24))}
          {{else}}
          ${Math.round((new Date(max_date.replace(/-/g, "/")) - new Date()) / (1000 * 60 * 60 * 24))}
          {{/if}}
          {{/if}}
          
          {{if $item.type == "take_back"}}
          {{if $item.overdue}}
          ${Math.round((new Date() - new Date(date.replace(/-/g, "/"))) / (1000 * 60 * 60 * 24))}
          {{else}}
          ${Math.round((new Date() - new Date(min_date.replace(/-/g, "/"))) / (1000 * 60 * 60 * 24))}
          {{/if}}
          {{/if}}
        
        -# RANGE TEXT #####################
        
        %span.text
          
          {{if $item.type == "order"}}
          {{if max_single_range < 2}}
          = _("Day")
          {{else}}
          = _("Days max")
          {{/if}}
          {{/if}}
          
          {{if $item.type == "hand_over"}}
          {{if $item.overdue}}
          = _("Days overdue")
          {{else}}
          = _("Days max")
          {{/if}}
          {{/if}}
          
          {{if $item.type == "take_back"}}
          {{if $item.overdue}}
          = _("Days overdue")
          {{else}}
          = _("Days max")
          {{/if}}
          {{/if}}
          
    -# PURPOSE #####################
      
    {{if purpose}}  
    
    = link_to "#{user_link_prefix}${user.id}#{acknowledge_postfix}${id}" do
      %li.purpose{:"data-title" => "${purpose}"}
        
        .tip_target
        
        %span.text
          {{html String(purpose).substring(0, DailyView.purpose_max) }}
          {{if String(purpose).length > DailyView.purpose_max}}
          {{html "..."}}
          {{/if}}
        
    {{else}}
    
    {{if $item.type == "order"}}
    = link_to "#{user_link_prefix}${user.id}#{acknowledge_postfix}${id}" do
      %li.purpose{:"data-title" => ""}
        %span.grey.text
          = _("No purpose")
    {{/if}}
    
    {{/if}}
    
    -# REMINDER ########################
      
    {{if $item.overdue}}
    .nolink
      %li.reminder
        {{if latest_remind}}
        %span.text
          = _("Lates Reminder:")
          {{html formatDate(new Date(latest_remind.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
        {{else}}
        %span.grey.text
          = _("No reminder yet")
        {{/if}}
      {{/if}}
    
    -# TO ########################
      
    {{if $item.type == "hand_over"}}
    {{if !$item.overdue}}
    .nolink
      %li.note
        %span.text
          {{html formatDate(new Date(max_date.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
    {{/if}}
    {{/if}}
    
    -# SINCE ########################
      
    {{if $item.type == "take_back"}}
    {{if !$item.overdue}}
    .nolink
      %li.note
        %span.text
          = _("since")
          {{html formatDate(new Date(min_date.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
    {{/if}}
    {{/if}}
    
    -# ACTIONS #####################
    
    %li.actions
      
      {{if $item.type == "order"}}
      = link_to "#{user_link_prefix}${user.id}#{acknowledge_postfix}${id}", :class => "smallbutton white" do
        = _("Edit")
        .icon.edit
      = link_to "#{user_link_prefix}${user.id}#{acknowledge_postfix}${id}#{approve_postfix}", :class => "smallbutton white", :remote => true, :method => :post do
        = _("Approve")
        .icon.approve
      {{/if}}
      
      {{if $item.type == "hand_over"}}
      {{if $item.overdue}}
      = link_to "javascript:void(0)", :class => "smallbutton red" do
        .icon.delete
        = _("Delete")
      = link_to "javascript:void(0)", :class => "smallbutton white" do
        = _("Remind")
        .icon.send
      = link_to "javascript:void(0)", :class => "smallbutton white" do
        = _("Hand Over")
        .icon.hand_over
        
      {{else}}
      
      = link_to "javascript:void(0)", :class => "smallbutton red" do
        .icon.delete
        = _("Delete")
      = link_to "javascript:void(0)", :class => "smallbutton white" do
        = _("Hand Over")
        .icon.hand_over
      {{/if}}
      {{/if}}
      
      {{if $item.type == "take_back"}}
      
      {{if $item.overdue}}
      = link_to "javascript:void(0)", :class => "smallbutton white" do
        = _("Remind")
        .icon.send
      = link_to "javascript:void(0)", :class => "smallbutton white" do
        = _("Take Back")
        .icon.take_back
        
      {{else}}
      
      = link_to "javascript:void(0)", :class => "smallbutton white" do
        = _("Take Back")
        .icon.take_back
      {{/if}}
      {{/if}}