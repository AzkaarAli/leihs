-content_for :title, _("Search Results for \"%s\"") % params[:term]

#search_results.innercontent

  .top
    %h1= yield :title
    %p.subtitle= _("Found %d matches") % @hits.values.sum
  
  %section.model
    .inlinetabs
      .tab.active
        .icon.model
        %span.text
          = _("Models")
        .badge
          = @hits["model"]
    .list
    
  %section.item
    .inlinetabs
      .tab.active
        .icon.item
        %span.text
          = _("Items")
        .badge
          = @hits["item"]
    .list
  
  %section.user
    .inlinetabs
      .tab.active
        .icon.user
        %span.text
          = _("Users")
        .badge
          = @hits["user"]
    .list
    
  %section.contract
    .inlinetabs
      .tab.active
        .icon.contract
        %span.text
          = _("Contracts")
        .badge
          = @hits["contract"]
    .list
    
  %section.order
    .inlinetabs
      .tab.active
        .icon.orders
        %span.text
          = _("Orders")
        .badge
          = @hits["order"]
    .list
    
:javascript
  
  $(document).ready(function(){
    $('.list').hide();
  
    var results = #{results_json(@results)};
  
    $.each(results, function(i, result){
      $('.'+result.type+' .list').append($.tmpl("tmpl/line", result)).parent().show();
    });
    
    $(".list").each(function(){
      var text = $(this).parent().find(".tab .text").first().html();
          text = text.replace(/<.*>.*<\/.*>/g, "");
      $(this).showMore({
        min: 3,
        offset: {
          top: -36
        },
        more: "<li><span class='text'>#{_('more')} "+text+"<span class='icon'></span></span></li>",
        less: "<li><span class='text'>#{_('show less')}<span class='icon'></span></span></li>"
      });
    });
    
    $('.list').show();
  });
