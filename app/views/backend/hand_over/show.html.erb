<div id='errors'>
	<%= render :partial => 'errors' %>
</div>


<div class="toolbar-main boxes">
	<div class="buttons">
		<%= link_to(image_tag($layout_public_path + "/images/icons/door.png") + " " + _("Close"),
								 { :controller => 'hand_over' }) %>

	</div>
</div>


			
			<div id="meta" class="boxes">
				<div id="meta-contract">
					<h2><%= _("Contract Nr.") + " #{@contract.id}" %></h2>
					<table cellspacing="0">
						<tr class="alt-row">
							<td>
								<%= _("Reserver") %>
							</td> 
							<td>
								<%= greybox_link_to_page(@contract.user.login,
									 { :controller => 'users', :action => 'show', :id => @contract.user.id },
    								 :title => _("User"),
									 :class => "iconized-notxt edit-user" ) %>
								<br />
								<% @user = @contract.user %>
								<%= render :partial => 'backend/users/resume' %>
							</td>
						</tr>
					</table>	
				</div>
				
			</div>

			<div class="table-overview boxes">
								
				<div class="toolbar-second">
					<h3>Pakete</h3>
					<div class="buttons">
						<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/package_add.png") + " " + _("Add Line"),
						 	{ :controller => 'hand_over', :action => 'add_line', :id => @contract.id },
							:title => _("Add Model") ) %>						

						<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/date_edit.png") + " " + _("Change Timeframe for selection"),
						 	{ :controller => 'hand_over', :action => 'time_lines', :id => @contract.id },
							:onmouseup => "change_href(this, 'contract_line', 'line');",
							:class => "multiple_selection_button",
							:title => _("Time Period") ) %>						

						<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/cancel.png") + " " + _("Delete selection"),
							{ :controller => 'hand_over', :action => 'remove_lines', :id => @contract.id },
							:onmouseup => "change_href(this, 'contract_line', 'line');",
							:class => "multiple_selection_button negative",
							:title => _("Remove Models") )
							# TODO contribute :with in greybox
							# :with => "'contract_lines=' + checkbox_values('contract_line_check')"
							%>
							
							<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/tab_go.png") + " " + _("Hand Over"),
							 	{ :controller => 'hand_over', :action => 'sign_contract', :id => @contract.id },
								:onmouseup => "change_href(this, 'contract_line', 'line');",
								:class => "multiple_selection_button",
								:title => _("Hand Over") ) %>
					</div>
				</div>
				
					<table cellspacing="0">
					<!-- start header -->
						<tr>
							<th scope="col">
								<input type="checkbox" id="contract_lines" onClick="mark_all(this, 'contract_line_check', 'multiple_selection_button');" /> <%= _("Alle Markieren") %>
								<br />
								<input type="checkbox" id="contract_lines" onClick="mark_all(this, 'contract_line_check_today', 'multiple_selection_button');" /> <%= _("Alle von Heute") %>
							</th>
							<th scope="col"><%= _("Paket") %></th>
							<th scope="col"><%= _("Zeitraum") %></th>
							<th scope="col">
								<%= _("Barcode") %>
								<br />
								<span class="barcode_pulldown">
								<%#= text_field_tag(:inventory_code, nil, { :size => 10, :onchange => remote_function( :url => { :action => 'assign_inventory_code', :id => @contract.id }, :with => "'code=' + value" ) }) %>
								<% model_ids = @contract.models.collect(&:id).uniq.join(',') %>
								<%= text_field_with_auto_complete :inventory_code, nil,
																{ :id => "inventory_code",
																  :size => 10,
																#  :onchange => remote_function( :url => { :action => 'assign_inventory_code', :id => @contract.id }, :with => "'code=' + value" ),
																  :onkeydown => "if(event.keyCode == 39){ inventory_code_auto_completer.activate(); }
																				 if(event.keyCode == 13){ " + remote_function( :url => { :action => 'assign_inventory_code', :id => @contract.id }, :with => "'code=' + value" ) + "}" },
																{ :url => { :controller => 'models', :action => 'available_items', :model_ids => model_ids },
																  :method => :get,
																  :with => "'code=' + element.value" } %>
								</span>								
							</th>
							<th scope="col"><%= _("Aktion") %></th>
						</tr>
					<!-- end header -->

					<!-- start iterator -->
					<% for @line in @contract.contract_lines %>
						<div id="contract_line_<%= @line.id %>">
							<tr class="alt-row">
								<td>
									<% check_box_today = (@line.start_date <= Date.today ? "contract_line_check_today" : "")  %>
									<%= check_box_tag('contract_lines[]', @line.id, false, :class => "contract_line_check #{check_box_today}", :onchange => "toggle_buttons('contract_line_check', 'multiple_selection_button');" ) %>
									<%= @line.quantity %>
								</td>
								<td>
									<%= greybox_link_to_page(@line.model.name,
									 { :controller => 'models', :action => 'show', :id => @line.model.id },
    								 :title => _("Model"),
									 :class => "thickbox iconized-notxt edit-package" ) %>
								</td>
								<td class="line_valid_<%= @line.available? %>">
									<%= greybox_link_to_page("#{short_date(@line.start_date)} - #{short_date(@line.end_date)}",
								 		{ :controller => 'hand_over', :action => 'time_lines', :id => @contract.id, :lines => @line.id },
										:class => "thickbox iconized-notxt date-edit",
										:id => "dates_#{@line.id}",
										:title => _("Time Period") ) %>
								</td>
								<td id="inventory_code_<%= @line.id %>" class="line_valid_<%= @line.complete? %>">
									<% @item = @line.item %>
									<%#old#= text_field(:item, :inventory_code,
										#			:id => "line_item_inventory_code_#{@line.id}",
										#			:size => 10,
										#			:onchange => remote_function( :url => { :action => 'change_line', :contract_line_id => @line.id}, :with => "'code=' + value" )) %>
									<%= text_field_with_auto_complete :item, :inventory_code,
																	{ :id => "line_item_inventory_code_#{@line.id}",
																	# :index => @line.id,
																	  :size => 10,
																	#  :onchange => remote_function( :url => { :action => 'change_line', :contract_line_id => @line.id }, :with => "'code=' + value" ),
																	  :onkeydown => "if(event.keyCode == 39){ line_item_inventory_code_#{@line.id}_auto_completer.activate(); }
																					 if(event.keyCode == 13){ " + remote_function( :url => { :action => 'change_line', :contract_line_id => @line.id }, :with => "'code=' + value" ) + "}" },
																	{ :url => { :controller => 'models', :action => 'available_items', :model_ids => @line.model.id },
																	  :method => :get,
																	  :with => "'code=' + element.value" } %>
								</td>
								<td><div class="buttons">
									<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/arrow_switch.png") + " " + _("Swap"),
										{ :controller => 'hand_over', :action => 'swap_model_line', :id => @contract.id, :line_id => @line.id },
    									:title => _("Swap Model") ) %>
									<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/cancel.png") + " " + _("Delete"),
									 	{ :controller => 'hand_over', :action => 'remove_lines', :id => @contract.id, :lines => @line.id },
    									:title => _("Remove Model"), :class => 'negative' ) %>

									</div></td>
							</tr>
						</div>
					<% end %>
					<!-- end iterator -->						

						</table>
						
			</div>
			

