-content_for :title, _("Hand Over to %s") % @user

#hand_over.innercontent
  .top
    %h1= _("Hand Over to %s") % @user
    
  %section.actiongroup
    = render :partial => '/backend/items/add_item'
    #selection_actions
      .selection
        %label
          = radio_button_tag "selection_range", "all"
          = _("All")
        %label
          = radio_button_tag "selection_range", "today"
          = _("Today")
        %label
          = radio_button_tag "selection_range", "selection"
          = _("Auswahl")
          %span.count= "(0)"
      .actions
        .multibutton
          .alternatives
            .trigger
              .arrow
            = link_to "", :class => "button white", :remote => "true" do
              .icon.timerange
              = _("Edit")
            = link_to "", :class => "button white", :remote => "true" do
              .icon.swap
              = _("Leaser")
            = link_to "/backend/inventory_pools/${current_inventory_pool}/users/${user.id}/acknowledge/${id}/reject", :class => "button white", :remote => "true" do
              .icon.valuelist
              = _("Value List")
          = link_to "", :class => "button green", :remote => "true" do
            = _("Hand Over Items")
    .clear
    
  %hr
  
  %section.linegroups

:javascript
  
  $(document).ready(function(){
    HandOver.setup();
    SelectionActions.setup();
  });
  
  var HandOver = new HandOver();
  
  function HandOver() {
    
    this.setup = function() {
      this.setupDatepicker();    
      this.setupTemplates();
    }
    
    this.setupTemplates = function () {
      $('#hand_over  .linegroups').append($.tmpl("tmpl/linegroup", #{@grouped_lines.to_json}));
    }
    
    this.setupDatepicker = function () {
      $.datepicker.setDefaults(i18n.selected.datepicker_backend);
      
      $('#add_item .dates input').each(function(){
        // format date
        if(! $(this).val().match(/\./)) {
          var date = new Date($(this).val().replace(/-/g, "/"));
          $(this).val($.datepicker.formatDate(i18n.selected.datepicker_backend.dateFormat, date));
        }
        
        // setup datepicker
        $(this).datepicker({
          showOtherMonths: true,
          selectOtherMonths: true,
        });
        
        // set min date only for end date
        if($(this).hasClass("end_date")) {
          $(this).datepicker( "option", "minDate", date);
        }
        
        // set min date updater when start date is closed
        if($(this).hasClass("start_date")) {
          $(this).change(function(){
            var date = $(this).datepicker("getDate");
            $(this).siblings(".end_date").datepicker("option", "minDate", date);
          });
        }
      });
    }
  }
