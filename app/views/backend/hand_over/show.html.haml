-content_for :title, _("Hand Over to %s") % @user

#hand_over.innercontent
  .top
    %h1= yield :title
    %p.subtitle
      = _("%i hand overs" % @visits.size)
      = _("in the next %i days" % range) if (range = (@visits.last.date - Date.today).to_i) > 0

  .indent      
    #selection_actions
      .selection
        %label
          = radio_button_tag "selection_range", "all"
          = _("All")
        %label
          = radio_button_tag "selection_range", "selection"
          = _("Auswahl")
          %span.count= "(0)"
      .actions
        = link_to "/backend/inventory_pools/#{current_inventory_pool.id}/hand_over/#{@user.id}/sign_contract", 
        :class => "button green open_dialog",
        :"data-rel" => "tmpl/dialog/hand_over/summary",
        :"data-dialog_class" => "hand_over",
        :"data-ref_for_dialog" => "$('#visits').tmplItem().data",
        :id => "hand_over_button" do
          = _("Hand Over")
    .clear
    
  %hr
  
  #visits
    
:javascript
  
  $(document).ready(function(){
    HandOver.setup();
    SelectionActions.setup($("#visits"));
    
    // bind the hand over button
    $("#hand_over_button").on("click", function(event){
      SelectionActions.storeSelectedLines();
    });
  });
  
  var HandOver = new HandOver();
  
  function HandOver() {
    
    this.setup = function(){
      this.setupTemplates();
      this.setupAssignInventoryCodes();
    }
    
    this.setupTemplates = function() {
      $('#visits').replaceWith($.tmpl("tmpl/visits", #{render(partial: "backend/visits/index.json.rjson", locals: {visits: @visits})}));
    }
    
    this.setupAssignInventoryCodes = function() {
      $(".item_line .inventory_code form").live("submit", ItemLine.assign_inventory_code);
    }
  } 