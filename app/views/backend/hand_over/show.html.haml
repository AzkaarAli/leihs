-content_for :title, _("Hand Over to %s") % @user

#hand_over.innercontent
  .top
    %h1= yield :title
    %p.subtitle

  .indent
    = form_tag add_line_backend_inventory_pool_user_hand_over_path(current_inventory_pool, @contract.user), 
    :id => "process_helper", 
    :method => :post, 
    :remote => true,
    :"data-add_selected_line_ids" => "true",
    :"data-submit_button" => true do
      .dates
        .container
          %input.start.date{:type => "text", :name => "start_date", :id => "add_start_date", :"data-date" => (@visits.blank?) ? Date.today : @visits.first.lines.first.start_date  , :title => _("Start Date")}
          %label{:for => "add_start_date"}
            = _("Start Date")
          %label.datepicker.icon{:for => "add_start_date", :title => _("Open Datepicker")}
        = "-"
        .container
          %input.end.date{:type => "text", :name => "end_date", :id => "add_end_date", :"data-date" => (@visits.blank?) ? Date.today : @visits.first.lines.first.end_date, :title => _("End Date")}
          %label{:for => "add_end_date"}
            = _("End Date")
          %label.datepicker.icon{:for => "add_end_date", :title => _("Open Datepicker")}  
            
      .container
        %input.autocomplete.barcode_target{:type => "text", :name => "code", :autocomplete => "off", :id => "code", 
        :"data-url" => backend_inventory_pool_search_path(current_inventory_pool, :types => ["model", "option", "template"]),
        :"data-autocomplete_class" => "add_item", 
        :"data-autocomplete_element_tmpl" => "tmpl/autocomplete/add_item",
        :"data-autocomplete_select_callback" => "ProcessHelper.add_through_autocomplete"}
        %label{:for => "code"}
          = _("Inventory Code / Name")
        
      %button.button.white{:type => "submit"}
        = _("Add/Assign")
        .icon.placeholder
  
    #selection_actions
    
      .selection
        = _("Auswahl")
        %span.count= "(0)"
        
      .actions
        .multibutton{:"data-toggle_on_line_selection" => true}
          .alternatives
            .trigger.green
              .arrow
            = link_to "/backend/inventory_pools/#{current_inventory_pool.id}/users/#{@user.id}/hand_over/update_lines", 
            :class => "button white open_dialog",
            :"data-rel" => "tmpl/dialog/calendar/edit_multiple", 
            :"data-dialog_class" => "calendar multiple",
            :"data-on_success" => 'HandOver.update_visits(response);',
            :id => "edit_selection" do
              .icon.timerange
              = _("Edit Selection")
            = link_to "/backend/inventory_pools/#{current_inventory_pool.id}/users/#{@contract.user.id}/hand_over/remove_lines",
            :class => "button white",
            :remote => "true",
            :method => "delete",
            :"data-rel" => "",
            :"data-dialog_class" => "",
            :"data-add_selected_line_ids" => "true",
            :"data-on_success" => "HandOver.remove_lines(SelectedLines.lines);",
            :"data-ref_for_dialog" => "",
            :id => "delete_selection" do
              .icon.delete
              = _("Delete")
        
          = link_to "/backend/inventory_pools/#{current_inventory_pool.id}/users/#{@user.id}/hand_over/sign_contract", 
          :class => "button green open_dialog",
          :"data-rel" => "tmpl/dialog/hand_over/summary",
          :"data-dialog_class" => "hand_over",
          :"data-add_selected_line_ids" => "true",
          :"data-on_success" => "HandOver.open_documents(response)",
          :id => "hand_over_button" do
            = _("Hand Over Items")
            
    .clear
  %hr
  
  #visits

:ruby
  inventory_pool_json = json_for current_inventory_pool, {:closed_days => true, :holidays => true}
  
  visits_json = json_for @visits, {:lines => {:is_valid => true,
                                              :item => {},
                                              :model => {},
                                              :contract => {:user => {:groups => {}}},
                                              :purpose => true,
                                              :availability => true}} 
    
:coffeescript    
  jQuery ->
    $('#visits').html($.tmpl("tmpl/visit", #{visits_json}))
    HandOver.setup()
    ProcessHelper.setup()
    SelectedLines.setup()
    window.InventoryPool = new InventoryPool(#{inventory_pool_json})
    
