-content_for :title, _("Take Back from %s") % @user

#take_back.innercontent
  .top
    %h1= yield :title
    %p.subtitle
  
  .indent
    = form_tag "", :id => "process_helper" do 
      .container
        %input.autocomplete.barcode_target{:type => "text", :name => "code", :autocomplete => "off", :id => "code", 
        :"data-url" => things_to_return_backend_inventory_pool_user_take_back_path(current_inventory_pool, @user),
        :"data-autocomplete_element_tmpl" => "tmpl/autocomplete/assign_item",
        :"data-autocomplete_class" => "assign_line",
        :"data-autocomplete_select_callback" => "TakeBack.assign_through_autocomplete"}
        %label{:for => "code"}
          = _("Inventory Code / Name")
      %button.button.white{:type => "submit"}
        = _("Assign")
        .icon.placeholder
        
    #selection_actions
    
      .selection
        = _("Auswahl")
        %span.count= "(0)"
        
      .actions
        .multibutton{:"data-toggle_on_line_selection" => true}
          .alternatives
            .trigger.green
              .arrow
            = link_to "/backend/inventory_pools/#{current_inventory_pool.id}/users/#{@user.id}/take_back/update_lines", 
            :class => "button white open_dialog",
            :"data-rel" => "tmpl/dialog/calendar/edit_multiple", 
            :"data-dialog_class" => "calendar multiple",
            :"data-on_success" => 'HandOver.update_visits(response);',
            :id => "edit_selection" do
              .icon.timerange
              = _("Edit Selection")
              
          = link_to "/backend/inventory_pools/#{current_inventory_pool.id}/users/#{@user.id}/take_back/close_contract", 
          :class => "button green open_dialog",
          :"data-rel" => "tmpl/dialog/take_back/summary",
          :"data-dialog_class" => "take_back",
          :"data-add_selected_line_ids" => "true",
          :"data-on_success" => "TakeBack.open_documents(response)",
          :id => "take_back_button" do
            = _("Take Back Items")
    .clear
    
  %hr
  
  #visits

:ruby
  visits_json = json_for(@visits, {:lines => {:item => {},
                                               :model => {},
                                               :contract => {:user => {:groups => {}}},
                                               :availability => true,
                                               :purpose => true }})
                                               
:coffeescript
  jQuery ->
    $('#visits').html($.tmpl("tmpl/visit", #{visits_json} ))
    TakeBack.setup()
    SelectedLines.setup()
