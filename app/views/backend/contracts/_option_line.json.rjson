h = {
  id: line.id,
  type: line.type.underscore,
  start_date: line.start_date,
  end_date: line.end_date,
  quantity: line.quantity,

  is_valid: line.valid?,  
  
  model: line.option, # this is an alias for option
  user: {
    id: line.contract.user_id,
    firstname: line.contract.user.firstname,
    lastname: line.contract.user.lastname,
    groups: line.contract.user.groups
  }
}

h[:availability_for_inventory_pool] = {:inventory_pool => current_inventory_pool.as_json } 

h