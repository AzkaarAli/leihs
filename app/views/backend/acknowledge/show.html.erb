<% if @order.errors.size > 0 %>
	<ul style="border: 1px solid red; padding: 2px;">
	<% @order.errors.full_messages.each do |e| %>		
		<li><%= e %></li>
	<% end %>	
	</ul>
<% end %>			



<div class="toolbar-main boxes">
	<div class="buttons">
		<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/door.png") + " " + _("Save + Approve"),
								 { :controller => 'acknowledge', :action => 'approve', :id => @order.id },
								 :title => _("Approve Order"),
								 :class => "positive") %>
		<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/door_out.png") + " " + _("Reject Order"),
								 { :controller => 'acknowledge', :action => 'reject', :id => @order.id },
								 :title => _("Reject Order")) %>


		<a href="modal-draft.html?KeepThis=true&TB_iframe=true&height=400&width=600" class="thickbox" title="Warnung (Modales Fenster)"><img src="images/icons/disk.png" alt="" />  Als Entwurf speichern</a>
		
		<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/cancel.png") + " " + _("Bestellung löschen"),
			{ :controller => 'acknowledge', :action => 'destroy', :id => @order.id },
			:title => _("Delete Order"), :class => 'negative') %>

	</div>
</div>
			
			<div id="meta" class="boxes">
				
				<div id="meta-bestellung">
					<h2><%= _("Bestellung Nr.") + " #{@order.id}" %></h2>
					<table cellspacing="0">
						<tr class="alt-row">
							<td><a href="modal-switch.html?KeepThis=true&TB_iframe=true&height=400&width=600" class="thickbox iconized-notxt arrow_switch" title="Warnung (Modales Fenster)">Reservierender:</a></td> 
							<td>
								<%= greybox_link_to_page(@order.user.login,
									 { :controller => 'users', :action => 'show', :id => @order.user.id },
    								 :title => _("User"),
									 :class => "iconized-notxt edit-user" ) %>
							</td>
						</tr>
						<tr class="alt-row">
							<td>Zeitfenster:</td>
							<td><%= short_date(@order.time_window_min) %> - <%= short_date(@order.time_window_max)%></td>
						</tr>
						<tr class="alt-row">
							<td><a href="modal-edit.html?KeepThis=true&TB_iframe=true&height=400&width=600" class="thickbox iconized-notxt edit-pencil" title="Warnung (Modales Fenster)">Verwendungszweck:</a></td>
							<td><%= @order.purpose %></td>
						</tr>
					</table>
				</div>
				
				<%= render :partial => 'additional_infos'%>
				
			</div>

			<script type="text/javascript">
				function checkbox_values(boxes){
					s = new Array();
					$$('body input.' + boxes).each(
						function(box){
							if(box.checked) s.push(box.value);
						}
					);
					return s;
				}
				
				//TODO write as generic
				function change_href(a){
					var cbv = checkbox_values('order_line_check');
					
					// TODO prevent execution without selection
					//if(cbv.length == 0) {
						// window.event.stopPropagation();
					//}else{
						b = a.href.split('?');
						a.href = b[0] + '?order_lines=' + cbv;
						decoGreyboxLinks();
					//}
				}

				function markAll(master, boxes){
					$$('body input.' + boxes).each(
						function(box){
							box.checked = master.checked
						}
					);
					
//					if(s.lenght > 0){
//						disabled=true
//					}else{
//					}

				}
				
			</script>
							
			<div class="table-overview boxes">
				
				<div class="toolbar-second">
					<h3>Pakete</h3>
					<div class="buttons">
						<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/package_add.png") + " " + _("Paket hinzufügen"),
						 	{ :controller => 'acknowledge', :action => 'add_line', :id => @order.id },
							:title => _("Add Model") ) %>						

						<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/date_edit.png") + " " + _("Markierte Zeitraum ändern"),
						 	{ :controller => 'acknowledge', :action => 'time_lines', :id => @order.id },
							:onmouseup => "change_href(this);",
							:disabled => "true",
							:title => _("Time Period") ) %>						

						<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/cancel.png") + " " + _("Markierte löschen"),
							{ :controller => 'acknowledge', :action => 'remove_lines', :id => @order.id },
							:onmouseup => "change_href(this);",
							:disabled => "true",
							:title => _("Remove Models"), :class => 'negative')
							# TODO contribute :with in greybox
							# :with => "'order_lines=' + checkbox_values('order_line_check')"
							%>
					</div>
				</div>
				
				
					<table cellspacing="0">
					<!-- start header -->
						<tr>
							<th scope="col"><input type="checkbox" id="order_lines" onClick="markAll(this, 'order_line_check');" /> <%= _("Alle Markieren") %></th>
							<th scope="col"><%= _("Paket") %></th>
							<th scope="col"><%= _("Zeitraum") %></th>
							<th scope="col"><%= _("Aktion") %></th>
						</tr>
					<!-- end header -->

					<!-- start iterator -->
					<% for @line in @order.order_lines %>
						<div id="order_line_<%= @line.id %>">
							<tr class="alt-row">
								<td><input type="checkbox" class="order_line_check" name="order_lines[]" value="<%= @line.id %>" /><%= text_field(:line, :quantity, :id =>"line_quantity_#{@line.id}", :size => 3, :onchange => remote_function( :url => { :action => 'change_line', :order_line_id => @line.id}, :with => "'quantity=' + value" )) %></td>
								<td><a href="modal-ansicht.html?KeepThis=true&TB_iframe=true&height=400&width=600" class="thickbox iconized-notxt edit-package" title="Warnung (Modales Fenster)"><%= @line.model.name %></a></td>
		
								<td><%= greybox_link_to_page("#{short_date(@line.start_date)} - #{short_date(@line.end_date)}",
								 		{ :controller => 'acknowledge', :action => 'time_lines', :id => @order.id, :order_lines => @line.id },
										:class => "thickbox iconized-notxt date-edit" ,
										:title => _("Time Period") ) %>
								</td>
								<td><div class="buttons">
									<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/arrow_switch.png") + " " + _("Swap"),
									 	{ :controller => 'acknowledge', :action => 'swap_line', :id => @order.id, :order_line_id => @line.id },
    									:title => _("Swap Model") ) %>
									<%= greybox_link_to_page(image_tag($layout_public_path + "/images/icons/cancel.png") + " " + _("Löschen"),
									 	{ :controller => 'acknowledge', :action => 'remove_lines', :id => @order.id, :order_lines => @line.id },
    									:title => _("Remove Model"), :class => 'negative' ) %>
									</div></td>
							</tr>
						</div>
					<% end %>
					<!-- end iterator -->						

						</table>
						
			</div>
			
					<div class="table-overview boxes">

						<div class="toolbar-second">
							<h3>Zubehör</h3>
							<div class="buttons">
								<a href="#"><img src="images/icons/package_add.png" alt="" />  Zubehör hinzufügen</a>
								<a href="#" class="negative"><img src="images/icons/cancel.png" alt="" />  Markierte löschen</a>
							</div>
						</div>

							<table cellspacing="0">
								<tr>
									<th scope="col"><input type="checkbox" /> Alle Markieren</th>
									<th scope="col">Anzahl/Stückzahl</th>
									<th scope="col">Bezeichnung</th>
									<th scope="col">Bemerkung</th>
									<th scope="col">Aktion</th>
								</tr>
								<tr class="alt-row">
									<td><input type="checkbox" /></td>
									<td><input type="text" /></td>
									<td><input type="text" /></td>
									<td><textarea></textarea></td>
									<td><div class="buttons"><a href="#" class="negative"><img src="images/icons/cancel.png" alt="" /> Löschen</a></div></td>
								</tr>
								
								
							</table>
					</div>
