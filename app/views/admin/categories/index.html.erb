<% unless request.xml_http_request? %>

<% if @category %>
	<% if request.env['REQUEST_URI'].include?("parents") %>
	 <div class="toolbar-second">
		<% form_for [:add_parent, :admin, @category],
					:html => { :onsubmit => "return ($('is_selected').value == 1);" } do |f| %>
			<%= hidden_field_tag :is_selected, 0 %>
			<%= _("Add as subcategory of") %>:
			<%= model_auto_completer ('query', nil, 'parent[category_id]', nil,
										{ :url => categories_path(:format => :auto_complete), :submit_on_return => true, :after_update_element => "function(){ $('is_selected').value = 1; }" },
										{ :size => 40 },
										{ :method => :get, :select => :name }) %>
			<%= _("Label") %>:
			<%= text_field_tag 'parent[label]' %></li>	

			<%= submit_tag 'Submit' %>
		<% end %>
	 </div>
	<% end %>
<% elsif @model %>
	 <div class="toolbar-second">
		<% form_tag admin_model_categories_path(@model),
					:onsubmit => "return ($('is_selected').value == 1);" do %>
			<%= hidden_field_tag :is_selected, 0 %>
			<%= _("Add to category") %>:
			<%= model_auto_completer ('query', nil, 'category_id', nil,
										{ :url => categories_path(:format => :auto_complete), :submit_on_return => true, :after_update_element => "function(){ $('is_selected').value = 1; }" },
										{ :size => 40 },
										{ :method => :get, :select => :name }) %>
			<%= submit_tag 'Submit' %>
		<% end %>
	 </div>
<% else %>
	<%= image_tag @graph if @graph %>
	 <div class="toolbar-second buttons">
		<%= link_to _("Create New"), :action => 'new' %>
	 </div>
<% end %>

<% end %>

<% table_with_search_and_pagination :columns => [_("Name"), _("Type"), _("Models"), _("All Models"), _("Children"), _("All Children"), _("Parents"), _("Action")],
						   			:records => @categories do |category| %>	

			<tr>
				<td><%= category.name %></td>
				<td><%= category.type %></td>
				<td><%= category.models.size %></td>
				<td><%= category.all_models.size %></td>
				<td><%= category.children.size %></td>
				<td><%= category.all_children.size %></td>
				<td><%= category.parents.size %></td>
				<td class="buttons" style="white-space: nowrap">
					<ul>
						<li><%= link_to _("Show"), admin_category_path(category) %></li>
						<li><%= link_to _("Delete"), admin_category_path(category),
										:confirm => _("Are you sure?"),
										:method => :delete if category.models.empty? and category.children.empty? %></li>
						<li><%= link_to _("Remove"), admin_model_category_path(@model, category),
										:confirm => _("Are you sure?"),
										:method => :delete if @model %></li>
						<li><%= link_to _("Remove Parent"), admin_category_path(@category, :parent_id => category.id),
										:confirm => _("Are you sure?"),
										:method => :delete if @category and @category.parents.include?(category) %></li>
					</ul>
				</td>
			</tr>

<% end %>

		