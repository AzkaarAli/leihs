:plain
  <section id="topfilter">
    <form class="availability" action="">
      <input class="date start" id="date_from" name="startdate" value="01.07.11"/>
      -
      <input class="date end" id="date_to" name="enddate" value="02.07.11" />
      <div class="checkarea">
          <input class="check" type="checkbox" name="available-only" value="available-only" id="available-only"/>
          <label for="available-only">#{_("Show Available")}</label>
          </div>
    </form><!-- availability -->
    
    <form class="sort" action="" method="get">
        <input class="submit" type="submit" value="#{_("Sort")}" />
        <div class="container">
          <select name="sort_and_sort_mode" class="styled">
            <option value="name ASC">#{_("Productname (A-Z)")}</option>
            <option value="name DESC">#{_("Productname (Z-A)")}</option>
            <option value="manufacturer ASC">#{_("Manufacturer (A-Z)")}</option>
            <option value="manufacturer DESC">#{_("Manufacturer (Z-A)")}</option>
          </select>
          </div><!-- .container -->
    </form><!-- sort -->
  </section><!-- #topfilter -->

:javascript
  function update_availability(){
    var sd = $("#date_from").datepicker( "getDate" );
    var ed = $("#date_to").datepicker( "getDate" );
    // TODO .getTime() ??
    //if (sd == null || ed == null) return;
    
    $("[data-availability]").each(function(){
      var availability_ips = $(this).data('availability');
      // TODO filter active inventory_pools
      var min_ips = $.map(availability_ips, function(elem){
        var min = 0;
        var to_min = [];
        var f1 = elem.availability.filter(function(x){
          var d = new Date(x[0]);
          return (d < sd);
        });
        if(f1.length) to_min.push(f1[f1.length-1][1]);
        var f2 = elem.availability.filter(function(x){
          var d = new Date(x[0]);
          return (sd <= d && d <= ed);
        });
        if(f2.length) to_min.push(Math.min.apply(Math, $.map(f2, function(x){ return x[1]; })));
        if(to_min.length) min = Math.min.apply(Math, to_min);
        return Math.max.apply(Math, [min, 0]);
      });
      var absolute_min = Math.min.apply(Math, min_ips);
      $(this).html(absolute_min);
    });
  }

  $(document).ready(function () {
    var dates = $('#topfilter .availability .date').datepicker({
      minDate: 0,
      firstDay: 1,
      showOtherMonths: true,
      selectOtherMonths: true,
      showButtonPanel: true,
      onSelect: function(selectedDate, instance) {
        var option = this.id == "date_from" ? "minDate" : "maxDate",
            date = $.datepicker.parseDate(instance.settings.dateFormat || $.datepicker._defaults.dateFormat, selectedDate, instance.settings );
        dates.not( this ).datepicker( "option", option, date );

        update_availability();
      }
    });

    update_availability();
  });
