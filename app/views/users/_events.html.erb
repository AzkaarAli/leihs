		
	var events_reader = new Ext.data.JsonReader({
		        root: 'events',
		        totalProperty: 'results',
		        id: 'id',
		        fields: [
					   {name: 'start', type: 'date'},
					   {name: 'title', type: 'string'},
					   {name: 'isDuration'},
					   {name: 'action', type: 'string'},
					   {name: 'inventory_pool.name'},
					   {name: 'user'},
					   {name: 'contract_lines'},
					   {name: 'quantity'}
		        ]
		    });

    var events_store = new Ext.data.Store({
        proxy: new Ext.data.HttpProxy(
			new Ext.data.Connection({
            	url: '/user/visits.ext_json',
				method: 'GET'
			})
        ),
		autoLoad: true,
        reader: events_reader
    });

    var events_cm = new Ext.grid.ColumnModel([
		{
           header: "Date",
           dataIndex: 'start',
           width: 100,
		   renderer: function(value,p,r){ return formatDate(value); }
		},{
           header: "Title",
           dataIndex: 'title',
           width: 400
		},{
           header: "Inventory Pool",
           dataIndex: 'inventory_pool.name',
           width: 200
		},{
           header: "Action",
           dataIndex: 'action',
           width: 200
		}]);

    var events_grid = new Ext.grid.GridPanel({
        title: 'Visits',
        store: events_store,
        cm: events_cm,
		viewConfig: { forceFit: true },
        loadMask: true,
		autoHeight: true,
		height: 'auto',
        tbar: ['->',
			new Ext.Action({
		        text: 'Visits',
				iconCls:'bt',
	            icon:'<%= $layout_public_path + "/images/icons/shape_align_left.png" %>',
		        handler: function(){
					account_panel.add(user_timeline);
		            Ext.getDom('user_timeline').innerHTML = "<iframe src='/user/timeline_visits' width='100%' height='500' frameborder='0'></iframe>";
					account_panel.activate(user_timeline);
		        }
		    })
        ]
    });

    // trigger the data store load
    //events_store.load();

