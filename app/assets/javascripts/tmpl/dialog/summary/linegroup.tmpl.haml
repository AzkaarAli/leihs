${$item.start_data_is_closed_day = currentInventoryPool.closed_days.indexOf(moment(start_date).day())>-1, ""}
${$item.end_data_is_closed_day = currentInventoryPool.closed_days.indexOf(moment(end_date).day())>-1, ""}

.date_range
  .date
    %span{:class => "start_date{{if $item.start_data_is_closed_day}} non-working-day{{/if}}"}<
      ${moment(start_date).format(i18n.date.L)}
      {{if $item.start_data_is_closed_day}}(${_jed("closed")}){{/if}}
    = "-" 
    %span{:class => "end_date{{if $item.end_data_is_closed_day}} non-working-day{{/if}}"}<
      ${moment(end_date).format(i18n.date.L)}
      {{if $item.end_data_is_closed_day}}(${_jed("closed")}){{/if}}
  .range
    ${$days = moment(end_date).eod().diff(moment(start_date).sod(), "days"), ""}
    ${$days}
    ${_jed($days, "day")}
    
.clear
.list
  {{each(i, line) App.Line.mergeByModel(lines)}}
  {{if line.sublines}}
  {{each(j, subline) line.sublines}}
  %input{:type => :hidden, :name => "line_ids[]", :value => "${subline.id}"}
  {{/each}}
  {{else}}
  %input{:type => :hidden, :name => "line_ids[]", :value => "${line.id}"}
  {{/if}}
  
  {{if line.returned_quantity}}
  %input{:type => :hidden, :name => "returned_quantity[${line.id}]", :value => "${line.returned_quantity}"}
  {{/if}}
  
  %ul{:class => "line {{if !line.is_available}} unavailable{{/if}}"}
    .main
      %li.quantity
        {{if line.returned_quantity}}
        ${line.returned_quantity}
        = "/"
        {{/if}}
        ${line.quantity}
      %li.model
        ${line.model.name}
    {{if Line.get_problems(line).length}}
    %li.problems
      ${_jed("Problems")}
    {{/if}}
  {{/each}}  