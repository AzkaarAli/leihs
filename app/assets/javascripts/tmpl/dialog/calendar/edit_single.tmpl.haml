= form_tag '${$item.action}', :remote => true do
  = hidden_field(:line_ids, "", :value => "${id}")
  %h1
    = _("Edit ordered item") 
  %p.subtitle
    = _("for")
    %strong
      ${order.user.firstname}
      ${order.user.lastname}
  .navigation
    %a.button.red.close_dialog
      = _("Cancel")
      .icon.delete
    %button.button.green{:type => "submit", :"data-on_success" => '${$item.on_success}', :tabindex => "4"}
      = _("Save Changes")
  
  .flash_message
  
  .calendar_input
    .quantity.container
      = text_field_tag :quantity, "${quantity}", :min => 1, :max => "${total_rentable}", :tabindex => "1", :class => "focus", :autocomplete => "off"
      %label{:for => "quantity"}
        = _("Quantity")
      = link_to "javascript:void(0)", :class => "increase" do
        %span.icon
      = link_to "javascript:void(0)", :class => "decrease" do
        %span.icon
    
    .date.container
      .start_date
        = text_field_tag :start_date, "${start_date}", :tabindex => "2", :autocomplete => "off"
        %label{:for => "start_date"}
          = _("Start Date")
          .icon.jumpto.fc-goto-start{:title => _("jump to this date")}
      .dash
        = "-"
      .end_date
        = text_field_tag :end_date, "${end_date}", :tabindex => "3", :autocomplete => "off"
        %label{:for => "end_date"}
          = _("End Date")
          .icon.jumpto.fc-goto-end{:title => _("jump to this date")}
          
    .inventorypool.container
      %select{:id => "inventory_pool_id", :name => "inventory_pool_id"}
        %option{:value => "current",
                :"data-total_borrowable" => "${JSON.stringify(total_rentable)}",
                :"data-closed_days" => "${JSON.stringify(availability_for_inventory_pool.inventory_pool.closed_days)}",
                :"data-availability_dates" => "${JSON.stringify(availability_for_inventory_pool.availability)}"}
          ${availability_for_inventory_pool.inventory_pool.name}
          
    .group.container
      %span.select
        %span.name
          = "Total"
        .arrow
        %select{:id => "group", :name => "group"}
          %option{:value => "", :"data-name" => _("Total"), :"data-total_rentable" => "${total_rentable}"}
            = _("Total (max. ${total_rentable})")
          {{each(i, group) availability_for_inventory_pool.partitions}}
          {{if group.group_id == 0}}
          %option{:value => "${group.group_id}", :"data-name" => _("General everyone"), :"data-total_rentable" => "${group.quantity}"}
            = _("General (max. ${group.quantity})")
          {{else}}
          %option{:value => "${group.group_id}", :"data-name" => "${group.name}", :"data-total_rentable" => "${group.quantity}"}
            = _("${group.name} (max. ${group.quantity})")
          {{/if}}
          {{/each}}
      %label{:for => "group"}
        = _("Group")
  
  .clear
  
  #fullcalendar
  
  .list
    {{tmpl($item.data) "tmpl/line/calendar_edit_line"}}
