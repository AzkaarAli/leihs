= link_to "javascript:void(0);" do #TODO: /backend/inventory_pools/${current_inventory_pool}/users/${user.id}/hand_over

  {{if overdue}}
  %li.overdue_icon
    .icon.hand_over.overdue
  %li.name.overdue.hastip
    ${user.firstname}
    ${user.lastname}
    .tip.user
      %table
        %tr
          %td.key
            %p
              = _("Phone")
          %td.value
            %p
              ${user.phone}
        %tr
          %td.key
            %p
              = _("E-Mail")
          %td.value
            %p
              ${user.email}
  {{else}}
  %li.name.hastip
    ${user.firstname}
    ${user.lastname}
    .tip.user
      %table
        %tr
          %td.key
            %p
              = _("Phone")
          %td.value
            %p
              ${user.phone}
        %tr
          %td.key
            %p
              = _("E-Mail")
          %td.value
            %p
              ${user.email}
  {{/if}}

  %li.items.hastip
    %span.number
      ${quantity}
    = _("Items")
    .tip.lines
      ${$startdate = 0, ""}
      ${$enddate = 0, ""}
      {{each(i, line) lines}}
      {{if line.start_date != $startdate || line.end_date != $enddate}}
      ${$startdate = line.start_date, ""}
      ${$enddate = line.end_date, ""}
      .date
        {{html formatDate(new Date(line.start_date.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
        = "-"
        {{html formatDate(new Date(line.end_date.replace(/-/g, "/")), i18n.selected.tips.dateFormat)}}
      .range
        ${Math.round((new Date(line.end_date.replace(/-/g, "/")) - new Date(line.start_date.replace(/-/g, "/"))) / (1000 * 60 * 60 * 24)+1)}
        = _("Days")
      .clear
      %table
        {{each(i, line) lines}}
        {{if line.start_date == $startdate && line.end_date == $enddate}}
        %tr
          %td.quantity
            ${line.quantity}
          %td.model_name
            ${line.model.name}
        {{/if}}
        {{/each}}  
      {{/if}}
      {{/each}}
  
  %li{:class => "range{{if overdue}} overdue{{/if}}"}
    %span.number
      {{if overdue}}
      ${Math.round((new Date() - new Date(date.replace(/-/g, "/"))) / (1000 * 60 * 60 * 24)+1)}
      {{else}}
      ${Math.round((new Date(max_date.replace(/-/g, "/")) - new Date()) / (1000 * 60 * 60 * 24)+1)}
      {{/if}}
    %span.text
      {{if overdue}}
      = _("Days overdue")
      {{else}}
      = _("Days max")
      {{/if}}
      
%li.actions
  {{if overdue}}
  .multibutton
    .alternatives
      .trigger
        .arrow
      = link_to "/backend/inventory_pools/${current_inventory_pool}/users/${user.id}/hand_over/delete_visit?lines=${contract_line_ids}", :class => "button red", :method => 'delete', :remote => "true", :"data-rel" => "tmpl/dialog/hand_over/delete", :"data-dialog_class" => "hand_over", :"data-on_success" => 'List.remove_line($(this).parents(".line"), "red")' , :"data-ref_for_dialog" => "$(this).closest('.line').tmplItem().data" do
        .icon.delete
        = _("Delete")
    = link_to "javascript:void(0);", :onclick => "alert('Diese Funktion wird bald implementiert...');",  :class => "button white" do #TODO: /backend/inventory_pools/${current_inventory_pool}/users/${user.id}/hand_over
      .icon.hand_over
      = _("Hand Over")
  {{else}}
  = link_to "javascript:void(0);", :onclick => "alert('Diese Funktion wird bald implementiert...');", :class => "button white" do #TODO: /backend/inventory_pools/${current_inventory_pool}/users/${user.id}/hand_over
    = _("Hand Over")
    .icon.hand_over
  {{/if}}
  
