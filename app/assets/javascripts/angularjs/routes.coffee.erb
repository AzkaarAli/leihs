root = global ? window
angular = root.angular

app = angular.module("Leihs", ['users', 'models', 'options', 'categories', 'filters', 'ui']).config(['$routeProvider', '$locationProvider', ($routeProvider, $locationProvider) ->
  #$locationProvider.hashPrefix('');
  $locationProvider.html5Mode true
  $routeProvider.when("/backend/inventory_pools/:inventory_pool_id/users",
    controller: UsersIndexCtrl
    templateUrl: '<%= asset_path("angularjs/templates/users/index.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/users/:id/edit",
      controller: UsersEditCtrl
      templateUrl: '<%= asset_path("angularjs/templates/users/edit.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/models/new",
      controller: ModelsCreateCtrl
      templateUrl: '<%= asset_path("angularjs/templates/models/edit.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/models/:id/edit",
      controller: ModelsEditCtrl
      templateUrl: '<%= asset_path("angularjs/templates/models/edit.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/options/new",
      controller: OptionsCreateCtrl
      templateUrl: '<%= asset_path("angularjs/templates/options/edit.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/options/:id/edit",
      controller: OptionsEditCtrl
      templateUrl: '<%= asset_path("angularjs/templates/options/edit.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/categories",
      controller: CategoriesIndexCtrl
      templateUrl: '<%= asset_path("angularjs/templates/categories/index.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/categories/new",
      controller: CategoriesCreateCtrl
      templateUrl: '<%= asset_path("angularjs/templates/categories/create.html") %>'
  ).when("/backend/inventory_pools/:inventory_pool_id/categories/:id/edit",
      controller: CategoriesEditCtrl
      templateUrl: '<%= asset_path("angularjs/templates/categories/edit.html") %>'
  )
]).run(['$location', '$rootElement', ($location, $rootElement) ->
    # http://stackoverflow.com/a/11785196/1966785
    $rootElement.off('click')
]).run(['$rootScope', ($rootScope)->
    $rootScope._jed = (args...)->
      _jed.apply(this, args)
    $rootScope.currentInventoryPool = currentInventoryPool
    $rootScope.i18n = i18n
])

root.app = app
